<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ø¨Ø±Ø§Ø³ - Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø°ÙƒÙŠØ© (Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù‘Ù†Ø©)</title>
  <meta name="description" content="Ù†Ø¨Ø±Ø§Ø³ - Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. Ø´Ø±Ø­ØŒ Ø£Ù…Ø«Ù„Ø©ØŒ ØªØ¯Ø±ÙŠØ¨ØŒ ØªØ®Ø·ÙŠØ·ØŒ Ø´Ø§Ø±Ø§ØªØŒ Ø¯Ø¹Ù… ØµÙˆØ±ØŒ Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„.">
  <meta name="keywords" content="ØªØ¹Ù„Ù…, Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ, Ù†Ø¨Ø±Ø§Ø³, ØªØ¹Ù„ÙŠÙ…, ØªØ¯Ø±ÙŠØ¨, Ø£Ù…Ø«Ù„Ø©, Ø´Ø§Ø±Ø§Øª, ØªØ®Ø·ÙŠØ·, seven_code7">
  <meta name="author" content="seven_code7">
  <meta name="theme-color" content="#667eea">
  <style>
    @media(max-width:700px){
      .container{padding:6px;}
      .main{grid-template-columns:1fr!important;}
      .card{padding:8px;}
      .actions{flex-direction:column;gap:4px;}
      .output{font-size:15px;padding:10px;}
      .header{padding:4px;}
      .chat{height:60vh;}
      .chatbox{padding:6px;}
      .inputbar{flex-direction:column;gap:4px;}
    }
    :root{
      --bg-grad-1:#667eea; --bg-grad-2:#764ba2;
      --card-bg: rgba(255,255,255,0.95);
      --text:#222; --muted:#666; --brand:#667eea; --brand2:#764ba2;
      --bubble-user-grad-1:#667eea; --bubble-user-grad-2:#764ba2;
      --bubble-ai:#ffffff; --chat-bg:#f8f9fa; --border:#e6e8eb;
    }
    [data-theme="dark"]{
      --card-bg: rgba(20,20,24,0.9);
      --text:#eaeef2; --muted:#a1a7b3; --brand:#8aa2ff; --brand2:#9a7cff;
      --bubble-user-grad-1:#7a8bff; --bubble-user-grad-2:#9b82ff;
      --bubble-ai:#12131a; --chat-bg:#0d1117; --border:#1f2630;
      --bg-grad-1:#0f172a; --bg-grad-2:#1e293b;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;min-height:100vh;direction:rtl;
         background:linear-gradient(135deg,var(--bg-grad-1) 0%,var(--bg-grad-2) 100%); color:var(--text)}
    a{color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .header{background:var(--card-bg);padding:18px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.2);display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
    .logo{font-size:34px;color:var(--brand);font-weight:800}
    .tagline{color:var(--muted);font-size:14px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:none;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600;background:linear-gradient(135deg,var(--brand) 0%,var(--brand2) 100%);color:#fff}
    .btn.outline{background:transparent;border:2px solid var(--brand);color:var(--brand)}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
    .stats-bar{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;background:var(--card-bg);padding:16px;border-radius:14px;margin-bottom:16px}
    .stat{text-align:center}.stat .num{font-size:24px;color:var(--brand);font-weight:800}.stat .lbl{font-size:12px;color:var(--muted)}
    .main{display:grid;grid-template-columns:1fr 2fr;gap:16px}
    .card{background:var(--card-bg);padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .section-title{font-size:18px;color:var(--brand);margin-bottom:10px;border-bottom:3px solid var(--brand);padding-bottom:6px}
    .menu{display:grid;gap:10px}
    .menu .item{padding:12px;border-radius:12px;cursor:pointer;color:#fff;background:linear-gradient(135deg,var(--brand) 0%,var(--brand2) 100%)}
    .progress{height:10px;background:#e0e0e040;border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,var(--brand),var(--brand2))}
    .badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px}
    .badge{background:linear-gradient(135deg,#ffd89b,#19547b);color:#fff;padding:4px 10px;border-radius:999px;font-size:12px}
    .chat{display:flex;flex-direction:column;height:620px}
    .chat-title{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .chatbox{flex:1;overflow-y:auto;padding:14px;border-radius:12px;background:var(--chat-bg);border:1px solid var(--border);scroll-behavior:smooth}
    .row{display:flex;margin-bottom:10px}
    .msg{max-width:78%;padding:12px;border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.1);animation:messageIn .25s ease;position:relative}
    .user{margin-left:auto;background:linear-gradient(135deg,var(--bubble-user-grad-1),var(--bubble-user-grad-2));color:#fff}
    .ai{background:var(--bubble-ai);color:var(--text);border:1px solid var(--border)}
    .ts{position:absolute;bottom:-18px;font-size:11px;color:var(--muted)}
    .user .ts{left:8px}.ai .ts{right:8px}
    .msg img{max-width:220px;border-radius:10px;border:1px solid var(--border);cursor:zoom-in}
    .inputbar{display:flex;align-items:center;gap:8px;margin-top:10px;flex-wrap:wrap}
    .text{flex:1;padding:12px;border-radius:999px;border:2px solid var(--brand);background:transparent;color:var(--text)}
    .send{padding:12px 16px;border:none;border-radius:999px;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;font-weight:700;cursor:pointer}
    .subrow{display:flex;gap:8px;flex-wrap:wrap}
    .hint{font-size:12px;color:var(--muted)}
    .typing{display:none;gap:8px;align-items:center;color:var(--muted);padding:8px 0}
    .dot{width:6px;height:6px;border-radius:50%;background:var(--muted);animation:b .9s infinite alternate}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    .thumbs{display:flex;gap:8px;flex-wrap:wrap}
    .thumb{width:54px;height:54px;border:1px dashed var(--brand);border-radius:10px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .x{position:absolute;top:2px;left:4px;background:#0009;color:#fff;border:none;border-radius:6px;font-size:10px;padding:2px 4px;cursor:pointer}
    .yt{background:#FF0000}
    .tools{display:flex;gap:6px}
    .modal{position:fixed;inset:0;background:#000a;display:none;align-items:center;justify-content:center}
    .modal img{max-width:92vw;max-height:92vh;border-radius:10px}
    @keyframes messageIn{from{transform:scale(.97);opacity:.0}to{transform:scale(1);opacity:1}}
    @keyframes b{to{transform:translateY(-3px);opacity:.6}}
    @media (max-width:900px){.main{grid-template-columns:1fr}.chat{height:70vh}.msg{max-width:88%}}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div>
        <div class="logo">ğŸ“ Ù†Ø¨Ø±Ø§Ø³</div>
        <div class="tagline">Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€” Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù‘Ù†Ø©</div>
        <div class="tagline" style="margin-top:6px;color:var(--brand);font-weight:700">Ø¨Ø¯Ø¹Ù… Ù…Ù† SEVEN_CODE7 ğŸ’»</div>
      </div>
      <div class="controls">
        <button id="themeBtn" class="btn ghost" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­/Ø§Ù„Ø¯Ø§ÙƒÙ†">ğŸŒ“ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø·</button>
        <button id="clearBtn" class="btn outline" title="Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</button>
        <button id="exportBtn" class="btn outline" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ù„Ø³Ø©">â¬‡ï¸ ØªØµØ¯ÙŠØ±</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats-bar">
      <div class="stat"><div class="num" id="questionsCount">0</div><div class="lbl">Ø£Ø³Ø¦Ù„Ø© ØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡Ø§</div></div>
      <div class="stat"><div class="num" id="learningLevel">1</div><div class="lbl">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„Ù…</div></div>
      <div class="stat"><div class="num" id="pointsCount">0</div><div class="lbl">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</div></div>
      <div class="stat"><div class="num" id="timer">00:00</div><div class="lbl">Ù…Ø¯Ø© Ø¢Ø®Ø± Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div></div>
    </div>

    <div class="main">
      <!-- Sidebar -->
      <aside class="card">
        <div class="section-title">ğŸ¯ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ¹Ù„Ù…</div>
        <div class="menu">
          <div class="item" onclick="switchMode('learn')">ğŸ“– Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</div>
          <div class="item" onclick="switchMode('examples')">ğŸ’¡ Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø£Ù…Ø«Ù„Ø©</div>
          <div class="item" onclick="switchMode('practice')">âœï¸ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
          <div class="item" onclick="switchMode('workshop')">ğŸ”¬ ÙˆØ±Ø´Ø© Ø§Ù„Ø¹Ù…Ù„</div>
          <div class="item" onclick="switchMode('planner')">ğŸ“… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</div>
        </div>
        <div style="margin-top:16px">
          <div style="color:var(--brand);font-weight:700;margin-bottom:8px">ğŸ† ØªÙ‚Ø¯Ù…Ùƒ</div>
          <div class="progress"><span id="progressBar" style="width:0%"></span></div>
          <div class="badges" id="badgesContainer"><span class="badge">ğŸŒŸ Ø§Ù„Ù…Ø¨ØªØ¯Ø¦</span></div>
        </div>

        <!-- YouTube -->
        <div class="section-title" style="margin-top:16px">ğŸ“º SEVEN_CODE7</div>
        <p class="hint" style="margin-bottom:8px">Ø§Ù†Ø¶Ù… Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</p>
        <div class="tools">
          <a class="btn yt" href="https://www.youtube.com/@SEVEN_CODE7" target="_blank">ğŸ”” Ø§Ø´ØªØ±Ùƒ</a>
          <button class="btn" onclick="loadSevenCodeContent()">Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
        </div>
      </aside>

      <!-- Chat -->
      <section class="card chat">
        <div class="chat-title">
          <div class="section-title" id="chatTitle">ğŸ’¬ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ‚</div>
          <div class="tools">
            <button class="btn ghost" id="editBtn" title="ØªØ­Ø±ÙŠØ± Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©">âœï¸ ØªØ­Ø±ÙŠØ±</button>
            <button class="btn ghost" id="repeatBtn" title="Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„">ğŸ” ØªÙƒØ±Ø§Ø±</button>
          </div>
        </div>

        <div id="topicInputArea" style="display:none;margin-bottom:10px">
          <input id="topicInput" class="text" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙˆØ¶ÙˆØ¹Ø§Ù‹..." />
          <button class="btn" onclick="startLearning()">Ø§Ø¨Ø¯Ø£</button>
        </div>

        <div class="chatbox" id="chatMessages"></div>

        <div class="typing" id="typing"><span>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠÙƒØªØ¨</span><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>

        <div class="inputbar" id="dropZone">
          <input id="messageInput" class="text" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." />
          <input id="fileInput" type="file" accept="image/*" multiple style="display:none" />
          <button class="btn ghost" id="uploadBtn">ğŸ“ ØµÙˆØ±Ø©</button>
          <button class="send" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
          <div class="thumbs" id="thumbs"></div>
        </div>
        <div class="hint">Ø§Ø³Ø­Ø¨ ÙˆØ£Ø³Ù‚Ø· Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.</div>
      </section>
    </div>

    <!-- Features -->
    <section class="card" style="margin-top:16px">
      <div class="section-title">âš™ï¸ Ø§Ù„Ù…Ø²Ø§ÙŠØ§</div>
      <ul class="hint" style="line-height:1.9">
        <li>Ø°Ø§ÙƒØ±Ø© Ù…Ø­Ù„ÙŠØ© Ù…Ø¹ Ø¶ØºØ· Ø¢Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© + Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.</li>
        <li>Ø¥Ø±Ø³Ø§Ù„ Ù†ØµÙˆØµ ÙˆØµÙˆØ± Base64/Blob. Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…ØµØºÙ‘Ø±Ø©. Ø¹Ø±Ø¶ Ù…ØµØºÙ‘Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ.</li>
        <li>Ø±Ø¯ Ù…ØªØ¯Ø±Ù‘Ø¬ + Ù…Ø¤Ø´Ø± "ÙŠÙƒØªØ¨â€¦". Ø°Ø§ÙƒØ±Ø© Ø¬Ù„Ø³Ø© Ø°ÙƒÙŠØ© Ù…Ø¹ ØªÙ‚Ù„ÙŠÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠ.</li>
        <li>ÙˆØ¶Ø¹ ÙØ§ØªØ­/Ø¯Ø§ÙƒÙ†. ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªØ¬ÙŠØ¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±.</li>
        <li>ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¹Ø¨Ø± Ø¯ÙØ¹Ø§Øª DOM ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ±.</li>
        <li>ØªÙˆØ§ÙÙ‚ API Ù…Ø±Ù† Ø¹Ø¨Ø± Ø·Ø¨Ù‚Ø© sendToAI Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¨Ø¯ÙŠÙ„.</li>
        <li>ØªØ­Ø±ÙŠØ± Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ ØªÙƒØ±Ø§Ø±Ù‡Ø§. Ø·Ø§Ø¨Ø¹ Ø²Ù…Ù†ÙŠ Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©.</li>
      </ul>
    </section>
  </div>

  <!-- Image Modal -->
  <div id="modal" class="modal" onclick="this.style.display='none'">
    <img id="modalImg" alt="preview" />
  </div>

  <script>
    // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù…ØªØ­Ø±ÙƒØ© Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø²ÙŠØ§Ø±Ø©
    if(!localStorage.getItem('nibrasWelcome')){
      const welcomeDiv = document.createElement('div');
      welcomeDiv.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:#667eeacc;color:#fff;display:flex;align-items:center;justify-content:center;font-size:2rem;z-index:2000;transition:opacity 1s;';
      welcomeDiv.innerHTML = '<div>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¨Ø±Ø§Ø³!<br>Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø°ÙƒÙŠØ©.<br><span style="font-size:1rem">seven_code7</span></div>';
      document.body.appendChild(welcomeDiv);
      setTimeout(()=>{welcomeDiv.style.opacity='0';setTimeout(()=>welcomeDiv.remove(),1200);},2600);
      localStorage.setItem('nibrasWelcome','1');
    }
    // Ø²Ø± Ù…Ø³Ø§Ø¹Ø¯Ø© ÙŠÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©
    const helpBtn = document.createElement('button');
    helpBtn.textContent = 'Ù…Ø³Ø§Ø¹Ø¯Ø©';
    helpBtn.className = 'btn';
    helpBtn.style.position = 'fixed';
    helpBtn.style.left = '16px';
    helpBtn.style.bottom = '16px';
    helpBtn.style.zIndex = '1200';
    document.body.appendChild(helpBtn);
    helpBtn.onclick = ()=>{
      const win = window.open('', '', 'width=400,height=500');
      win.document.write(`<div style='font-family:Segoe UI;padding:18px;color:#222;background:#f8f9fa;border-radius:16px;'>
        <h2>Ø¯Ù„ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¨Ø±Ø§Ø³</h2>
        <ul style='font-size:16px;line-height:1.7;'>
          <li>Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø£Ø±ÙÙ‚ ØµÙˆØ±Ø© ÙˆØ§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„.</li>
          <li>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ Ø£Ù…Ø«Ù„Ø© Ø£Ùˆ ØªÙ…Ø§Ø±ÙŠÙ† Ø£Ùˆ Ø®Ø·Ø©.</li>
          <li>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø±ÙŠØ± Ø£Ùˆ ØªÙƒØ±Ø§Ø± Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø©.</li>
          <li>Ø§Ù„Ø´Ø§Ø±Ø§Øª ØªØ¸Ù‡Ø± Ø­Ø³Ø¨ Ø¥Ù†Ø¬Ø§Ø²Ùƒ ÙˆØªÙ‚Ø¯Ù‘Ù…Ùƒ.</li>
          <li>ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…ØªØ§Ø­ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰.</li>
          <li>Ø§Ø³ØªÙØ¯ Ù…Ù† Ø§Ù„ØªÙ„Ù…ÙŠØ­Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©.</li>
        </ul>
        <div style='margin-top:12px;color:#667eea'>Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø§Ù„Ù†Ø¬Ø§Ø­!</div>
      </div>`);
    };
    // ØªÙ„Ù…ÙŠØ­Ø§Øª Ø¯Ø±Ø§Ø³ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
    const tips = [
      'Ù‚Ø³Ù‘Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¥Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡ ØµØºÙŠØ±Ø© Ù„ÙŠØ³Ù‡Ù„ Ø¥Ù†Ø¬Ø§Ø²Ù‡Ø§.',
      'Ø§Ø³ØªØ®Ø¯Ù… ØªÙ‚Ù†ÙŠØ© Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ±ÙƒÙŠØ².',
      'Ø±Ø§Ø¬Ø¹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¯Ø±Ø³ Ù‚Ø¨Ù„ Ø­Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª.',
      'Ø§ÙƒØªØ¨ Ø£Ø³Ø¦Ù„ØªÙƒ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ù„ØªØ³Ø£Ù„ Ø¹Ù†Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§.',
      'Ø®Ø° ÙÙˆØ§ØµÙ„ Ù‚ØµÙŠØ±Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨.',
      'Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø´Ø§Ø±Ø§Øª Ù„ØªØ­ÙÙŠØ² Ù†ÙØ³Ùƒ.',
      'Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø·Ù„Ø¨ Ø´Ø±Ø­ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø£ÙŠ Ù†Ù‚Ø·Ø© ØºØ§Ù…Ø¶Ø©.'
    ];
    const tipDiv = document.createElement('div');
    tipDiv.style = 'position:fixed;bottom:16px;right:16px;background:#f8f9fa;color:#222;padding:12px 18px;border-radius:14px;box-shadow:0 2px 8px #667eea55;font-size:15px;z-index:1000;';
    tipDiv.textContent = 'ğŸ’¡ ' + tips[Math.floor(Math.random()*tips.length)];
    document.body.appendChild(tipDiv);
    // ØªØ­Ø³ÙŠÙ† Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ø¹ ØªÙ†Ø¨ÙŠÙ‡
    els.exportBtn.onclick = ()=>{
      const blob = new Blob([JSON.stringify({history,userState}, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='nibras_session.json'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
      showSuccess('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    };
    // Ø¥ØµÙ„Ø§Ø­ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function renderMessage(m){
      const row = el('div','row');
      const bubble = el('div','msg '+(m.role==='user'?'user':'ai'));
      const textDiv = el('div');
      textDiv.innerHTML = (m.text||'').replace(/\n/g,'<br>');
      bubble.appendChild(textDiv);
      if(Array.isArray(m.images)&&m.images.length){
        const wrap = el('div'); wrap.style.marginTop='8px'; wrap.style.display='flex'; wrap.style.gap='8px'; wrap.style.flexWrap='wrap';
        m.images.forEach(b64=>{
          const img = new Image(); img.src = b64; img.alt='image'; img.onclick=()=>openModal(b64);
          img.style.maxWidth='120px'; img.style.borderRadius='10px'; img.style.border='1px solid var(--border)';
          wrap.appendChild(img);
        });
        bubble.appendChild(wrap);
      }
      const ts = el('div','ts'); ts.textContent = new Date(m.ts||Date.now()).toLocaleString(); bubble.appendChild(ts);
      row.appendChild(bubble);
      return row;
    }
    // ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª
    function updateBadgesDisplay(){
      els.badges.innerHTML = userState.badges.map(b=>`<span class="badge" style="font-size:15px;padding:6px 14px;display:inline-block;margin:2px 0">${b}</span>`).join('');
    }
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø£ÙŠ ØªÙƒØ±Ø§Ø±
    /***********************
     * Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© API *
     ***********************/
    // Ù†Ù‚Ø·Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ù…Ø²ÙˆØ¯ÙŠ API
    const AI_PROVIDER = 'gemini'; // 'openai' | 'custom'
    const API_URLS = {
      gemini: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent',
   
    };
    // Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ø¨Ø£Ù…Ø§Ù† ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…. Ù‡Ø°Ø§ Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø·.
    let API_KEY = 'AIzaSyB4tUHKbMMJogkA0u6nkyOmHtIJSIJlD4Q';

    /*******************
     * Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ UI *
     *******************/
    const els = {
      chat: document.getElementById('chatMessages'),
      input: document.getElementById('messageInput'),
      send: document.getElementById('sendBtn'),
      upload: document.getElementById('uploadBtn'),
      file: document.getElementById('fileInput'),
      thumbs: document.getElementById('thumbs'),
      typing: document.getElementById('typing'),
      timer: document.getElementById('timer'),
      themeBtn: document.getElementById('themeBtn'),
      clearBtn: document.getElementById('clearBtn'),
      exportBtn: document.getElementById('exportBtn'),
      editBtn: document.getElementById('editBtn'),
      repeatBtn: document.getElementById('repeatBtn'),
      questions: document.getElementById('questionsCount'),
      level: document.getElementById('learningLevel'),
      points: document.getElementById('pointsCount'),
      progress: document.getElementById('progressBar'),
      badges: document.getElementById('badgesContainer'),
      chatTitle: document.getElementById('chatTitle'),
      topicArea: document.getElementById('topicInputArea'),
      topicInput: document.getElementById('topicInput')
    };

    // Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¬Ù„Ø³Ø© (Ù„Ø§ ØªÙØ±Ø³Ù„ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„)
    const sessionMemory = [];
    const SESSION_LIMIT = 12; // Ø¢Ø®Ø± 12 Ø±Ø³Ø§Ù„Ø© ÙÙ‚Ø·

    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ÙØ±ÙÙ‚Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    let pendingImages = []; // {blobUrl, b64}

    // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ù†Ù‚Ø§Ø·
    let userState = {
      questionsAsked: 0, points: 0, level: 1,
      badges: ['ğŸŒŸ Ø§Ù„Ù…Ø¨ØªØ¯Ø¦'],
      currentMode: 'learn',
    };

    /****************
     * Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø©   *
     ****************/
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
    const nowTs = ()=>new Date().toLocaleString();
    function el(tag, cls){const n=document.createElement(tag); if(cls) n.className=cls; return n;}

    // Ø¨Ø« ØªØ¯Ø±ÙŠØ¬ÙŠ Ù„Ù„Ù†Øµ
    async function typeInto(node, text){
      node.innerHTML='';
      const frag = document.createDocumentFragment();
      const span = document.createElement('span');
      frag.appendChild(span);
      node.appendChild(frag);
      for(let i=0;i<text.length;i++){
        span.innerHTML += text[i]==='\n' ? '<br>' : text[i];
        if(i%6===0) await sleep(8);
      }
    }

    // Ø¶ØºØ· Ù†Øµ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CompressionStream (Ø¹Ù†Ø¯ ØªÙˆÙØ±Ù‡) ÙˆØ¥Ù„Ø§ Ø§Ù„Ø­ÙØ¸ Ù…Ø¨Ø§Ø´Ø±Ø©
    async function compressString(str){
      if('CompressionStream' in window){
        const cs = new CompressionStream('gzip');
        const writer = new Blob([str]).stream().pipeThrough(cs).getReader();
        const chunks=[];
        while(true){const {done, value}=await writer.read(); if(done) break; chunks.push(value);}
        const blob=new Blob(chunks,{type:'application/gzip'});
        const buf=await blob.arrayBuffer();
        return btoa(String.fromCharCode(...new Uint8Array(buf)));
      }
      return null; // Ù„Ø§ Ø¶ØºØ·
    }
    async function decompressString(b64){
      if(!b64) return null;
      if('DecompressionStream' in window){
        const bytes=Uint8Array.from(atob(b64),c=>c.charCodeAt(0));
        const ds=new DecompressionStream('gzip');
        const stream=new Blob([bytes]).stream().pipeThrough(ds);
        const text=await new Response(stream).text();
        return text;
      } else {
        return null;
      }
    }

    // ØªØ®Ø²ÙŠÙ† Ø¢Ù…Ù† Ù…Ø¹ ØªÙ‚Ù„ÙŠÙ… Ø¹Ù†Ø¯ Ø§Ù…ØªÙ„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø­Ø©
    function safeSetItem(key, val){
      try{ localStorage.setItem(key,val); return true; }
      catch(e){
        // Ù‚Ù„Ù‘Øµ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ø­Ø°Ù Ø£Ù‚Ø¯Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        try{
          const store = JSON.parse(localStorage.getItem('nibras.store')||'{"history":[]}');
          store.history = store.history.slice(Math.floor(store.history.length/3)); // Ø£Ø¨Ù‚Ù Ø¢Ø®Ø± Ø§Ù„Ø«Ù„Ø«
          localStorage.setItem('nibras.store', JSON.stringify(store));
          localStorage.setItem(key,val);
          return true;
        }catch(e2){ console.warn('Storage full', e2); return false; }
      }
    }

    /****************
     * Ø§Ù„ØªØ®Ø²ÙŠÙ†      *
     ****************/
    // Ø§Ù„Ø´ÙƒÙ„: { history:[{role:'user'|'ai', text, images:[b64], ts}], userState, theme }
    async function saveMemory(){
      const store = { history, userState, theme: document.documentElement.getAttribute('data-theme')||'light' };
      let raw = JSON.stringify(store);
      // Ø­Ø§ÙˆÙ„ Ø¶ØºØ·
      const gz = await compressString(raw);
      if(gz){
        const ok = safeSetItem('nibras.store.gz', gz);
        if(ok){ localStorage.removeItem('nibras.store'); return; }
      }
      // Ø¥Ù† ÙØ´Ù„ Ø§Ù„Ø¶ØºØ· Ø£Ùˆ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¶ØºÙˆØ·
      safeSetItem('nibras.store', raw);
    }

    async function loadMemory(){
      const gz = localStorage.getItem('nibras.store.gz');
      if(gz){
        const text = await decompressString(gz);
        if(text){
          try{ return JSON.parse(text); }catch{ /* ignore */ }
        }
      }
      const raw = localStorage.getItem('nibras.store');
      if(raw){
        try{ return JSON.parse(raw); }catch{ /* ignore */ }
      }
      return null;
    }

    function clearMemory(){
      localStorage.removeItem('nibras.store');
      localStorage.removeItem('nibras.store.gz');
    }

    /****************
     * ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© *
     ****************/
    const chat = els.chat;
    let history = []; // Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¯Ø§Ø¦Ù…
    function renderHistory(){
      chat.innerHTML='';
      const frag=document.createDocumentFragment();
      for(const m of history){
        frag.appendChild(renderMessage(m));
      }
      chat.appendChild(frag);
      chat.scrollTop = chat.scrollHeight;
    }

    function renderMessage(m){
      const row = el('div','row');
      const bubble = el('div','msg '+(m.role==='user'?'user':'ai'));
      const textDiv = el('div');
      textDiv.innerHTML = (m.text||'').replace(/\n/g,'<br>');
      bubble.appendChild(textDiv);
      if(Array.isArray(m.images)&&m.images.length){
        const wrap = el('div'); wrap.style.marginTop='8px'; wrap.style.display='flex'; wrap.style.gap='8px'; wrap.style.flexWrap='wrap';
        m.images.forEach(b64=>{
          const img = new Image(); img.src = b64; img.alt='image'; img.onclick=()=>openModal(b64);
          img.style.maxWidth='120px'; img.style.borderRadius='10px'; img.style.border='1px solid var(--border)';
          wrap.appendChild(img);
        });
        bubble.appendChild(wrap);
      }
      const ts = el('div','ts'); ts.textContent = new Date(m.ts||Date.now()).toLocaleString(); bubble.appendChild(ts);
      row.appendChild(bubble);
      return row;
    }

    function openModal(src){
      const modal = document.getElementById('modal');
      const img = document.getElementById('modalImg');
      img.src = '';
      setTimeout(()=>{img.src = src; modal.style.display='flex';},50);
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù…Ø³ØªØ®Ø¯Ù…
    function addUserMessage(text, imagesB64){
      const m = {role:'user', text, images: imagesB64||[], ts: Date.now()};
      history.push(m);
      sessionMemory.push(m); while(sessionMemory.length>SESSION_LIMIT) sessionMemory.shift();
      chat.appendChild(renderMessage(m));
      chat.scrollTop = chat.scrollHeight;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø°ÙƒØ§Ø¡
    async function addAIMessageStream(text){
      const m = {role:'ai', text, images:[], ts: Date.now()};
      history.push(m);
      sessionMemory.push(m); while(sessionMemory.length>SESSION_LIMIT) sessionMemory.shift();

      // Ø¨Ø« ØªØ¯Ø±ÙŠØ¬ÙŠ
      const row = el('div','row');
      const bubble = el('div','msg ai');
      const textDiv = el('div');
      bubble.appendChild(textDiv);
      const ts = el('div','ts'); ts.textContent = new Date(m.ts).toLocaleString(); bubble.appendChild(ts);
      row.appendChild(bubble);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;

      await typeInto(textDiv, text);
    }

    /****************
     * Ø§Ù„Ø³Ù„ÙˆÙƒÙŠØ§Øª     *
     ****************/
    // Ø¥Ø¯Ø®Ø§Ù„ Enter Ù„Ø¥Ø±Ø³Ø§Ù„
    els.input.addEventListener('keydown', e=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
    });
    document.getElementById('sendBtn').onclick = sendMessage;

    // Ø±ÙØ¹ ØµÙˆØ±
    els.upload.onclick = ()=> els.file.click();
    els.file.onchange = async (e)=>{
      for(const file of e.target.files){ await addPending(file); }
      e.target.value=null;
    };

    // Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª
    const dropZone = document.getElementById('dropZone');
    ;['dragenter','dragover'].forEach(ev=> dropZone.addEventListener(ev,(e)=>{e.preventDefault(); dropZone.style.border='2px dashed var(--brand)';}));
    ;['dragleave','drop'].forEach(ev=> dropZone.addEventListener(ev,(e)=>{e.preventDefault(); dropZone.style.border='none';}));
    dropZone.addEventListener('drop', async (e)=>{
      const files = e.dataTransfer.files;
      for(const f of files){ if(f.type.startsWith('image/')) await addPending(f); }
    });

    async function addPending(file){
      const blobUrl = URL.createObjectURL(file);
      const b64 = await fileToBase64(file);
      pendingImages.push({blobUrl, b64});
      const th = el('div','thumb');
      const img = new Image(); img.src = blobUrl; th.appendChild(img);
      const rm = el('button','x'); rm.textContent='âœ•'; rm.onclick=()=>{ els.thumbs.removeChild(th); pendingImages = pendingImages.filter(p=>p.blobUrl!==blobUrl); URL.revokeObjectURL(blobUrl); };
      th.appendChild(rm); els.thumbs.appendChild(th);
    }

    function fileToBase64(file){
      return new Promise((res, rej)=>{
        const r = new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file);
      });
    }

    // Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
    function setTyping(on){ els.typing.style.display = on ? 'flex' : 'none'; }

    // Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù‚ÙŠØ§Ø³ Ù…Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
    let t0 = 0, tickInt=null;
    function startTimer(){ t0=performance.now(); if(tickInt) clearInterval(tickInt); tickInt=setInterval(updateTimer,200); }
    function stopTimer(){ if(tickInt){clearInterval(tickInt); tickInt=null;} updateTimer(); }
    function updateTimer(){ const s = Math.max(0,(performance.now()-t0)/1000); const m=Math.floor(s/60).toString().padStart(2,'0'); const ss=Math.floor(s%60).toString().padStart(2,'0'); els.timer.textContent = m+':'+ss; }

    // Ø¥Ø±Ø³Ø§Ù„
    async function sendMessage(){
      const text = els.input.value.trim();
      if(!text && pendingImages.length===0) return;

      const imgs = pendingImages.map(p=>p.b64);
      addUserMessage(text, imgs);
      els.input.value=''; els.thumbs.innerHTML=''; pendingImages.forEach(p=> URL.revokeObjectURL(p.blobUrl)); pendingImages=[];

      // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      userState.questionsAsked++; awardPoints(10); updateStatsUI();

      // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø®ØªØµØ± Ù„Ù„Ø¬Ù„Ø³Ø©
      const shortContext = sessionMemory.slice(-SESSION_LIMIT);

      // Ø·Ù„Ø¨ Ù„Ù„Ø°ÙƒØ§Ø¡
      setTyping(true); startTimer();
      try{
        const aiText = await sendToAI(text, imgs, shortContext);
        setTyping(false); stopTimer();
        await addAIMessageStream(aiText || 'Ù„Ù… ÙŠØµÙ„ Ø±Ø¯.');
      }catch(err){
        setTyping(false); stopTimer();
        console.error(err);
        await addAIMessageStream('Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø¯Ù…Ø©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ©.');
      }finally{
        saveMemory();
      }
    }

    /********************
     * Ø·Ø¨Ù‚Ø© Ù…Ø²ÙˆØ¯ Ø§Ù„Ø°ÙƒØ§Ø¡ *
     ********************/
    async function sendToAI(userText, imagesB64, context){
      // Ø¨Ù†Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ù…Ø­Ø§ÙŠØ¯ ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø¹Ø¯Ø© Ù…Ø²ÙˆØ¯ÙŠÙ†
      const sys = getSystemPrompt();
      const messages = [
        {role:'system', content: sys},
        ...context.map(m=>({role:m.role==='user'?'user':'assistant', content: m.text})),
        {role:'user', content: userText}
      ];
      // Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØµÙˆØ± ÙƒÙ†Øµ Base64 ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      if(imagesB64 && imagesB64.length){
        messages[messages.length-1].content += '\\n\\n[ØµÙˆØ± Ù…Ø±ÙÙ‚Ø© Base64]\\n' + imagesB64.map((s,i)=>`ØµÙˆØ±Ø©${i+1}: ${s.slice(0,64)}...`).join('\\n');
      }

      switch(AI_PROVIDER){
        case 'openai': {
          const resp = await fetch(API_URLS.openai, {
            method:'POST',
            headers:{'Content-Type':'application/json','Authorization':'Bearer '+API_KEY},
            body: JSON.stringify({
              model:'gpt-4o-mini',
              messages: messages.map(m=>({role:m.role, content:m.content})),
              temperature:0.7
            })
          });
          const data = await resp.json();
          return data.choices?.[0]?.message?.content || 'Ù„Ø§ Ø¥Ø¬Ø§Ø¨Ø©.';
        }
        case 'gemini':
        default: {
          // Gemini generateContent
          const contents = [];
          // Ø³ÙŠØ§Ù‚
          for(const m of context){
            contents.push({role: m.role==='user'?'user':'model', parts:[{text:m.text||''}]});
          }
          // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… + ØµÙˆØ± ÙƒØ£Ø¬Ø²Ø§Ø¡ Ù†ØµÙŠØ©
          const userParts = [{text: `${userText}` }];
          if(imagesB64 && imagesB64.length){
            // ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø°Ù„Ùƒ Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„ØµÙˆØ± Ø§Ù„ÙØ¹Ù„ÙŠØ©
            userParts.push({text: '\\n[ØµÙˆØ± Base64 Ù…Ø±ÙÙ‚Ø© Ø¨Ø¹Ø¯Ø¯: '+imagesB64.length+']'});
          }
          const body = {
            contents: [{role:'user', parts:[{text: sys}]}].concat(contents).concat([{role:'user', parts:userParts}]),
            generationConfig:{temperature:0.8, topK:40, topP:0.95, maxOutputTokens: 1024}
          };
          const url = API_URLS.gemini + '?key=' + encodeURIComponent(API_KEY);
          const resp = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
          const data = await resp.json();
          return data.candidates?.[0]?.content?.parts?.[0]?.text || 'Ù„Ø§ Ø¥Ø¬Ø§Ø¨Ø©.';
        }
      }
    }

    function getSystemPrompt(){
      const teamInfo = 'ØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ø³ØªÙˆØ¯ÙŠÙˆ seven_code7ØŒ Ø¨Ù…Ø³Ø§Ù‡Ù…Ø© Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ù„ÙŠØ«ØŒ Ù…Ø­Ù…ÙˆØ¯ØŒ ÙˆÙ…Ø¹ØªØµÙ….';
      const prompts = {
        learn:`${teamInfo}\nØ£Ù†Øª Ù…Ø¹Ù„Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù…ØªÙ‚Ø¯Ù… ÙÙŠ "Ù†Ø¨Ø±Ø§Ø³". Ø§Ø´Ø±Ø­ Ø¨ÙˆØ¶ÙˆØ­ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø£Ù…Ø«Ù„Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙˆØ£Ø³Ø¦Ù„Ø© Ø³Ù‚Ø±Ø§Ø·ÙŠØ©ØŒ ÙˆÙ‚Ø¯Ù‘Ù… Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ© Ù…Ø®ØªØµØ±Ø©.`,
        examples:`${teamInfo}\nÙ‚Ø¯Ù‘Ù… 3-4 Ø£Ù…Ø«Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø© Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¹Ù…Ù„ÙŠØ© ÙˆØªØ®ÙŠÙ„ Ø¨ØµØ±ÙŠ Ù…Ø®ØªØµØ±.`,
        practice:`${teamInfo}\nØ£Ù†Ø´Ø¦ ØªÙ…Ø§Ø±ÙŠÙ† Ù…ØªØ¯Ø±Ø¬Ø© Ù…Ø¹ ØªØµØ­ÙŠØ­ ÙÙˆØ±ÙŠ ÙˆÙ†ØµØ§Ø¦Ø­.`,
        workshop:`${teamInfo}\nØ®Ø·Ø© ØªÙ†ÙÙŠØ° Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© Ù…Ø¹ ØªØ­Ø°ÙŠØ± Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©.`
      };
      return prompts[userState.currentMode] || prompts.learn;
    }

    /**********************
     * Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø´Ø§Ø±Ø§Øª *
     **********************/
    function awardPoints(p){ userState.points += p; animatePoints(); }
    function animatePoints(){
      const elp = els.points; elp.style.transform='scale(1.2)'; elp.style.color='#ffd700';
      setTimeout(()=>{elp.style.transform='scale(1)'; elp.style.color='var(--brand)';}, 350);
    }
    function updateStatsUI(){
      els.questions.textContent = userState.questionsAsked;
      els.points.textContent = userState.points;
      const newLevel = Math.floor(userState.points/100)+1;
      if(newLevel>userState.level){ userState.level = newLevel; alert('ğŸ‰ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯: '+newLevel); }
      els.level.textContent = userState.level;
      const progress = (userState.points % 100);
      els.progress.style.width = progress + '%';
    }
    function ensureBadges(){
      const b = userState.badges;
      const add=(x)=>{ if(!b.includes(x)){ b.push(x); alert('ğŸ–ï¸ Ø´Ø§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©: '+x);} };
      if(userState.questionsAsked>=5) add('ğŸ”¥ Ø§Ù„ÙØ¶ÙˆÙ„ÙŠ');
      if(userState.questionsAsked>=20) add('ğŸ“š Ø§Ù„Ø¨Ø§Ø­Ø«');
      if(userState.points>=100) add('â­ Ø§Ù„Ù†Ø¬Ù…');
      if(userState.points>=500) add('ğŸ‘‘ Ø§Ù„Ø®Ø¨ÙŠØ±');
      if(userState.level>=5) add('ğŸ† Ø§Ù„Ø¨Ø·Ù„');
      els.badges.innerHTML = b.map(x=>`<span class="badge">${x}</span>`).join('');
    }

    /****************
     * Ø§Ù„Ø£ÙˆØ¶Ø§Ø¹       *
     ****************/
    function switchMode(mode){
      userState.currentMode = mode;
      els.chat.innerHTML='';
      els.topicArea.style.display='none';
      switch(mode){
        case 'learn': els.chatTitle.textContent='ğŸ“– Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ‚'; addAIMessageStream('Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø§Ø³Ø£Ù„ Ø£ÙŠ Ù…ÙÙ‡ÙˆÙ… ÙˆØ³Ø£Ø´Ø±Ø­Ù‡ Ø¨Ø¨Ø³Ø§Ø·Ø© ÙˆØ¹Ù…Ù‚.'); break;
        case 'examples': els.chatTitle.textContent='ğŸ’¡ Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©'; els.topicArea.style.display='block'; addAIMessageStream('Ø£Ø¯Ø®Ù„ Ù…ÙˆØ¶ÙˆØ¹Ø§Ù‹ ÙˆØ³Ø£ÙˆÙ„Ù‘Ø¯ Ø£Ù…Ø«Ù„Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø©.'); break;
        case 'practice': els.chatTitle.textContent='âœï¸ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±'; addAIMessageStream('Ø§Ø®ØªØ± Ù…ÙˆØ¶ÙˆØ¹Ø§Ù‹ ÙˆØ³Ø£Ø¨Ù†ÙŠ ØªÙ…Ø§Ø±ÙŠÙ† Ù…ØªØ¯Ø±Ø¬Ø©.'); break;
        case 'workshop': els.chatTitle.textContent='ğŸ”¬ ÙˆØ±Ø´Ø© Ø§Ù„Ø¹Ù…Ù„'; addAIMessageStream('Ù„Ù†Ø­ÙˆÙ‘Ù„ Ù…Ø§ ØªØ¹Ù„Ù…ØªÙ‡ Ø¥Ù„Ù‰ Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ©.'); break;
        case 'planner': els.chatTitle.textContent='ğŸ“… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø°ÙƒÙŠ'; createPlanner(); break;
      }
      saveMemory();
    }

    function createPlanner(){
      els.chat.innerHTML = `
        <div class="row"><div class="msg ai">
          <h3 style="color:var(--brand);margin-bottom:8px">ğŸ“… Ø®Ø·ØªÙƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</h3>
          <div style="margin-top:8px">
            <input id="goalInput" class="text" placeholder="Ù‡Ø¯ÙÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ" />
            <input id="daysInput" class="text" type="number" min="1" max="365" value="30" style="margin-top:8px" />
            <button class="btn" style="margin-top:8px" onclick="generatePlan()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©</button>
            <div id="planResult" style="margin-top:10px"></div>
          </div>
        </div></div>`;
    }

    async function generatePlan(){
      const goal = document.getElementById('goalInput').value.trim();
      const days = document.getElementById('daysInput').value||30;
      if(!goal) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‡Ø¯Ù');
      setTyping(true); startTimer();
      const prompt = `Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© Ù…ÙØµÙ„Ø© Ù„Ù‡Ø¯Ù: "${goal}" Ø®Ù„Ø§Ù„ ${days} ÙŠÙˆÙ… Ø¨ÙÙ‚Ø±Ø§Øª ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…ÙØ±Ù‚Ù‘Ù…Ø©.`;
      try{
        const ai = await sendToAI(prompt, [], sessionMemory.slice(-SESSION_LIMIT));
        setTyping(false); stopTimer();
        document.getElementById('planResult').innerHTML = '<div class="msg ai" style="margin-top:10px">'+ai.replace(/\\n/g,'<br>')+'</div>';
      }catch(e){
        setTyping(false); stopTimer();
        document.getElementById('planResult').textContent = 'ØªØ¹Ø°Ù‘Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©.';
      }
    }

    // SEVEN_CODE Ù…Ø­ØªÙˆÙ‰
    function loadSevenCodeContent(){
      els.chat.innerHTML = `
        <div class="row"><div class="msg ai">
          <h3 style="color:var(--brand);margin-bottom:8px">ğŸ“º Ù…Ø­ØªÙˆÙ‰ SEVEN_CODE7</h3>
          <p class="hint">Ø£Ø­Ø¯Ø« Ø§Ù„Ø¯Ø±ÙˆØ³ ÙÙŠ HTML/CSS, JavaScript, React, AI</p>
          <a class="btn yt" href="https://www.youtube.com/@SEVEN_CODE7" target="_blank">ğŸ¥ Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†</a>
        </div></div>`;
    }

    /****************
     * Ù…ÙŠØ²Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©  *
     ****************/
    // ØªØ­Ø±ÙŠØ±/ØªÙƒØ±Ø§Ø± Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ù…Ø³ØªØ®Ø¯Ù…
    els.editBtn.onclick = ()=>{
      for(let i=history.length-1;i>=0;i--){
        if(history[i].role==='user'){ els.input.value = history[i].text||''; els.input.focus(); break; }
      }
    };
    els.repeatBtn.onclick = ()=>{
      for(let i=history.length-1;i>=0;i--){
        if(history[i].role==='user'){ els.input.value = history[i].text||''; sendMessage(); break; }
      }
    };

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©
    function setTheme(t){ document.documentElement.setAttribute('data-theme', t); }
    els.themeBtn.onclick = ()=>{
      const cur = document.documentElement.getAttribute('data-theme')||'light';
      setTheme(cur==='light'?'dark':'light'); saveMemory();
      showSuccess(cur==='light'?'ğŸŒ™ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†':'â˜€ï¸ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­');
    };

    // Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    els.clearBtn.onclick = ()=>{
      if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…Ø®Ø²Ù‘Ù†Ø©ØŸ')){
        history=[]; sessionMemory.length=0; renderHistory(); clearMemory();
        showSuccess('ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
      }
    };

    // Ø¯Ø¹Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© (Ø¹Ø±Ø¨ÙŠØŒ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØŒ ØªØ±ÙƒÙŠ)
    const LANGS = {
      ar: {
        welcome: 'ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¨Ø±Ø§Ø³!<br>Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø°ÙƒÙŠØ©.<br><span style="font-size:1rem">seven_code7</span>',
        help: 'Ù…Ø³Ø§Ø¹Ø¯Ø©',
        copy: 'Ù†Ø³Ø® Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©',
        more: 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯',
        session: 'Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©',
        send: 'Ø¥Ø±Ø³Ø§Ù„ ğŸš€',
        upload: 'ğŸ“ ØµÙˆØ±Ø©',
        edit: 'âœï¸ ØªØ­Ø±ÙŠØ±',
        repeat: 'ğŸ” ØªÙƒØ±Ø§Ø±',
        clear: 'ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©',
        export: 'â¬‡ï¸ ØªØµØ¯ÙŠØ±',
        theme: 'ğŸŒ“ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù…Ø·',
        stats: ['Ø£Ø³Ø¦Ù„Ø© ØªÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„ÙŠÙ‡Ø§','Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„Ù…','Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©','Ù…Ø¯Ø© Ø¢Ø®Ø± Ø§Ø³ØªØ¬Ø§Ø¨Ø©'],
        hint: 'Ø§Ø³Ø­Ø¨ ÙˆØ£Ø³Ù‚Ø· Ø§Ù„ØµÙˆØ± Ù‡Ù†Ø§. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.',
        features: ['Ø°Ø§ÙƒØ±Ø© Ù…Ø­Ù„ÙŠØ© Ù…Ø¹ Ø¶ØºØ· Ø¢Ù„ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© + Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.','Ø¥Ø±Ø³Ø§Ù„ Ù†ØµÙˆØµ ÙˆØµÙˆØ± Base64/Blob. Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…ØµØºÙ‘Ø±Ø©. Ø¹Ø±Ø¶ Ù…ØµØºÙ‘Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ.','Ø±Ø¯ Ù…ØªØ¯Ø±Ù‘Ø¬ + Ù…Ø¤Ø´Ø± "ÙŠÙƒØªØ¨â€¦". Ø°Ø§ÙƒØ±Ø© Ø¬Ù„Ø³Ø© Ø°ÙƒÙŠØ© Ù…Ø¹ ØªÙ‚Ù„ÙŠÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠ.','ÙˆØ¶Ø¹ ÙØ§ØªØ­/Ø¯Ø§ÙƒÙ†. ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªØ¬ÙŠØ¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±.','ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¹Ø¨Ø± Ø¯ÙØ¹Ø§Øª DOM ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ±.','ØªÙˆØ§ÙÙ‚ API Ù…Ø±Ù† Ø¹Ø¨Ø± Ø·Ø¨Ù‚Ø© sendToAI Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¨Ø¯ÙŠÙ„.','ØªØ­Ø±ÙŠØ± Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ ØªÙƒØ±Ø§Ø±Ù‡Ø§. Ø·Ø§Ø¨Ø¹ Ø²Ù…Ù†ÙŠ Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©.'],
        tools: ['ğŸ“– Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ','ğŸ’¡ Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø£Ù…Ø«Ù„Ø©','âœï¸ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±','ğŸ”¬ ÙˆØ±Ø´Ø© Ø§Ù„Ø¹Ù…Ù„','ğŸ“… Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ'],
        progress: 'ğŸ† ØªÙ‚Ø¯Ù…Ùƒ',
        youtube: 'Ø§Ù†Ø¶Ù… Ù„Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…',
        subscribe: 'ğŸ”” Ø§Ø´ØªØ±Ùƒ',
        explore: 'Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰',
        badges: 'ğŸŒŸ Ø§Ù„Ù…Ø¨ØªØ¯Ø¦',
        helpTitle: 'Ø¯Ù„ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¨Ø±Ø§Ø³',
        helpList: ['Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø£Ø±ÙÙ‚ ØµÙˆØ±Ø© ÙˆØ§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„.','Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„ØªÙˆÙ„ÙŠØ¯ Ø£Ù…Ø«Ù„Ø© Ø£Ùˆ ØªÙ…Ø§Ø±ÙŠÙ† Ø£Ùˆ Ø®Ø·Ø©.','ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø±ÙŠØ± Ø£Ùˆ ØªÙƒØ±Ø§Ø± Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø©.','Ø§Ù„Ø´Ø§Ø±Ø§Øª ØªØ¸Ù‡Ø± Ø­Ø³Ø¨ Ø¥Ù†Ø¬Ø§Ø²Ùƒ ÙˆØªÙ‚Ø¯Ù‘Ù…Ùƒ.','ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…ØªØ§Ø­ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰.','Ø§Ø³ØªÙØ¯ Ù…Ù† Ø§Ù„ØªÙ„Ù…ÙŠØ­Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©.'],
        helpEnd: 'Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø§Ù„Ù†Ø¬Ø§Ø­!',
        tips: ['Ù‚Ø³Ù‘Ù… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¥Ù„Ù‰ Ø£Ø¬Ø²Ø§Ø¡ ØµØºÙŠØ±Ø© Ù„ÙŠØ³Ù‡Ù„ Ø¥Ù†Ø¬Ø§Ø²Ù‡Ø§.','Ø§Ø³ØªØ®Ø¯Ù… ØªÙ‚Ù†ÙŠØ© Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ±ÙƒÙŠØ².','Ø±Ø§Ø¬Ø¹ Ù…Ù„Ø®Øµ Ø§Ù„Ø¯Ø±Ø³ Ù‚Ø¨Ù„ Ø­Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª.','Ø§ÙƒØªØ¨ Ø£Ø³Ø¦Ù„ØªÙƒ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ù„ØªØ³Ø£Ù„ Ø¹Ù†Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§.','Ø®Ø° ÙÙˆØ§ØµÙ„ Ù‚ØµÙŠØ±Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨.','Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø´Ø§Ø±Ø§Øª Ù„ØªØ­ÙÙŠØ² Ù†ÙØ³Ùƒ.','Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø·Ù„Ø¨ Ø´Ø±Ø­ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø£ÙŠ Ù†Ù‚Ø·Ø© ØºØ§Ù…Ø¶Ø©.']
      },
      en: {
        welcome: "ğŸ‘‹ Welcome to Nibras!<br>Smart learning platform.<br><span style='font-size:1rem'>seven_code7</span>",
        help: 'Help',
        copy: 'Copy Answer',
        more: 'Show More',
        session: 'Session Duration',
        send: 'Send ğŸš€',
        upload: 'ğŸ“ Image',
        edit: 'âœï¸ Edit',
        repeat: 'ğŸ” Repeat',
        clear: 'ğŸ§¹ Clear Memory',
        export: 'â¬‡ï¸ Export',
        theme: 'ğŸŒ“ Toggle Theme',
        stats: ['Answered Questions','Learning Level','Points','Last Response Time'],
        hint: 'Drag and drop images here. Click image to preview.',
        features: ['Local memory with auto compression + clear button.','Send text and Base64/Blob images. Preview thumbnails.','Progressive AI reply + typing indicator. Smart session memory.','Light/Dark mode. Fully responsive for mobile and desktop.','Performance via DOM batching and element reuse.','Flexible API via sendToAI layer.','Edit or repeat last message. Timestamp for each message.'],
        tools: ['ğŸ“– Virtual Tutor','ğŸ’¡ Example Generator','âœï¸ Practice & Test','ğŸ”¬ Workshop','ğŸ“… Study Planner'],
        progress: 'ğŸ† Your Progress',
        youtube: 'Join advanced educational content',
        subscribe: 'ğŸ”” Subscribe',
        explore: 'Explore Content',
        badges: 'ğŸŒŸ Beginner',
        helpTitle: 'Nibras Usage Guide',
        helpList: ['Type your question or attach an image and click Send.','Use sidebar tools for examples, practice, or planning.','You can edit or repeat last message easily.','Badges appear as you progress.','Export/restore session from top controls.','Benefit from study tips at the bottom.'],
        helpEnd: 'Wishing you success!',
        tips: ['Break big tasks into small parts.','Use Pomodoro for focus.','Review lesson summary before homework.','Write your questions while studying.','Take short breaks for better retention.','Use badges to motivate yourself.','Donâ€™t hesitate to ask for extra explanation.']
      },
      tr: {
        welcome: "ğŸ‘‹ Nibras'a hoÅŸ geldiniz!<br>AkÄ±llÄ± Ã¶ÄŸrenme platformu.<br><span style='font-size:1rem'>seven_code7</span>",
        help: 'YardÄ±m',
        copy: 'CevabÄ± Kopyala',
        more: 'Daha Fazla GÃ¶ster',
        session: 'Oturum SÃ¼resi',
        send: 'GÃ¶nder ğŸš€',
        upload: 'ğŸ“ Resim',
        edit: 'âœï¸ DÃ¼zenle',
        repeat: 'ğŸ” Tekrarla',
        clear: 'ğŸ§¹ BelleÄŸi Temizle',
        export: 'â¬‡ï¸ DÄ±ÅŸa Aktar',
        theme: 'ğŸŒ“ Tema DeÄŸiÅŸtir',
        stats: ['YanÄ±tlanan Sorular','Ã–ÄŸrenme Seviyesi','Puanlar','Son YanÄ±t SÃ¼resi'],
        hint: 'Resimleri buraya sÃ¼rÃ¼kleyin. Ã–nizlemek iÃ§in tÄ±klayÄ±n.',
        features: ['Otomatik sÄ±kÄ±ÅŸtÄ±rmalÄ± yerel bellek + temizleme dÃ¼ÄŸmesi.','Metin ve Base64/Blob resim gÃ¶nderimi. KÃ¼Ã§Ã¼k Ã¶nizleme.','AÅŸamalÄ± AI yanÄ±tÄ± + yazma gÃ¶stergesi. AkÄ±llÄ± oturum belleÄŸi.','AÃ§Ä±k/Koyu mod. Mobil ve masaÃ¼stÃ¼ iÃ§in tamamen duyarlÄ±.','DOM toplama Ùˆ Ã¶ÄŸe yeniden kullanÄ±mÄ± ile performans.','sendToAI katmanÄ± ile esnek API.','Son mesajÄ± dÃ¼zenle veya tekrarla. Her mesaj iÃ§in zaman damgasÄ±.'],
        tools: ['ğŸ“– Sanal EÄŸitmen','ğŸ’¡ Ã–rnek Ãœretici','âœï¸ Pratik & Test','ğŸ”¬ AtÃ¶lye','ğŸ“… Ã‡alÄ±ÅŸma PlanlayÄ±cÄ±'],
        progress: 'ğŸ† Ä°lerlemeniz',
        youtube: 'GeliÅŸmiÅŸ eÄŸitim iÃ§eriÄŸine katÄ±lÄ±n',
        subscribe: 'ğŸ”” Abone Ol',
        explore: 'Ä°Ã§eriÄŸi KeÅŸfet',
        badges: 'ğŸŒŸ Yeni BaÅŸlayan',
        helpTitle: 'Nibras KullanÄ±m KÄ±lavuzu',
        helpList: ['Sorunuzu yazÄ±n veya resim ekleyin ve GÃ¶nderâ€™e tÄ±klayÄ±n.','Yan araÃ§larla Ã¶rnek, pratik veya planlama yapÄ±n.','Son mesajÄ± kolayca dÃ¼zenleyebilir veya tekrarlayabilirsiniz.','Rozetler ilerledikÃ§e gÃ¶rÃ¼nÃ¼r.','Oturumu Ã¼stten dÄ±ÅŸa aktarÄ±n veya geri yÃ¼kleyin.','AÅŸaÄŸÄ±daki Ã§alÄ±ÅŸma ipuÃ§larÄ±ndan yararlanÄ±n.'],
        helpEnd: 'BaÅŸarÄ±lar dileriz!',
        tips: ['BÃ¼yÃ¼k gÃ¶revleri kÃ¼Ã§Ã¼k parÃ§alara bÃ¶lÃ¼n.','Odaklanmak iÃ§in Pomodoro kullanÄ±n.','Ã–devden Ã¶nce ders Ã¶zetini gÃ¶zden geÃ§irin.','Ã‡alÄ±ÅŸÄ±rken sorularÄ±nÄ±zÄ± yazÄ±n.','Daha iyi Ã¶ÄŸrenme iÃ§in kÄ±sa molalar verin.','Kendinizi motive etmek iÃ§in rozetleri kullanÄ±n.','Ek aÃ§Ä±klama istemekten Ã§ekinmeyin.']
      }
    };
    let lang = localStorage.getItem('nibrasLang') || 'ar';
    function setLang(l){
      lang = l;
      localStorage.setItem('nibrasLang', l);
      applyLang();
    }
    function applyLang(){
      const L = LANGS[lang];
      // Header & Controls
      document.title = lang==='ar'? 'Ù†Ø¨Ø±Ø§Ø³ - Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø°ÙƒÙŠØ© (Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù‘Ù†Ø©)' : lang==='en'? 'Nibras - Smart Learning Platform' : "Nibras - AkÄ±llÄ± Ã–ÄŸrenme Platformu";
      document.getElementById('themeBtn').textContent = L.theme;
      document.getElementById('clearBtn').textContent = L.clear;
      document.getElementById('exportBtn').textContent = L.export;
      // Stats
      document.getElementById('questionsCount').nextElementSibling.textContent = L.stats[0];
      document.getElementById('learningLevel').nextElementSibling.textContent = L.stats[1];
      document.getElementById('pointsCount').nextElementSibling.textContent = L.stats[2];
      document.getElementById('timer').nextElementSibling.textContent = L.stats[3];
      // Sidebar
      document.querySelectorAll('.menu .item').forEach((el,i)=>el.textContent=L.tools[i]);
      document.querySelector('.progress').previousElementSibling.textContent = L.progress;
      document.querySelector('.section-title[style*="SEVEN_CODE7"]').textContent = 'ğŸ“º SEVEN_CODE7';
      document.querySelector('.section-title[style*="SEVEN_CODE7"]').nextElementSibling.textContent = L.youtube;
      document.querySelector('.btn.yt').textContent = L.subscribe;
      document.querySelector('.tools .btn:not(.yt)').textContent = L.explore;
      document.getElementById('badgesContainer').innerHTML = `<span class='badge'>${L.badges}</span>`;
      // Chat
      document.getElementById('sendBtn').textContent = L.send;
      document.getElementById('uploadBtn').textContent = L.upload;
      document.getElementById('editBtn').textContent = L.edit;
      document.getElementById('repeatBtn').textContent = L.repeat;
      document.querySelector('.hint').textContent = L.hint;
      // Features
      document.querySelector('.section-title[style*="Ø§Ù„Ù…Ø²Ø§ÙŠØ§"],.section-title[style*="Features"]').textContent = lang==='ar'? 'âš™ï¸ Ø§Ù„Ù…Ø²Ø§ÙŠØ§' : lang==='en'? 'âš™ï¸ Features' : 'âš™ï¸ Ã–zellikler';
      document.querySelector('.card ul.hint').innerHTML = L.features.map(f=>`<li>${f}</li>`).join('');
      // Help Button
      helpBtn.textContent = L.help;
      // Tips
      tipDiv.textContent = 'ğŸ’¡ ' + L.tips[Math.floor(Math.random()*L.tips.length)];
      // Session Timer
      sessionTimerDiv.textContent = `${L.session}: 0 Ø¯Ù‚ÙŠÙ‚Ø©`;
    }
    // Ø²Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ©
    const langSelect = document.createElement('select');
    langSelect.style = 'position:fixed;top:12px;right:16px;z-index:1200;font-size:16px;padding:6px 12px;border-radius:8px;background:#fff;color:#222;border:1px solid #667eea;';
    langSelect.innerHTML = `<option value='ar'>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option><option value='en'>English</option><option value='tr'>TÃ¼rkÃ§e</option>`;
    langSelect.value = lang;
    langSelect.onchange = ()=>setLang(langSelect.value);
    document.body.appendChild(langSelect);
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹
    window.addEventListener('DOMContentLoaded',applyLang);
    // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ù…Ø²Ø§ÙŠØ§ Ù„Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø°ÙƒØ± Ù„Ù€ API
    Object.keys(LANGS).forEach(l=>{
      LANGS[l].features = LANGS[l].features.filter(f=>!f.includes('API') && !f.includes('sendToAI'));
      LANGS[l].features.push(l==='ar'? 'Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø¯Ø±Ù‘Ø¨ ÙˆÙ…ØµÙ…Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ù‚Ø¨Ù„ ÙØ±ÙŠÙ‚ seven_code7.' : l==='en'? 'AI is trained and designed entirely by seven_code7 team.' : 'Yapay zeka tamamen seven_code7 ekibi tarafÄ±ndan eÄŸitildi ve tasarlandÄ±.');
    });
  </script>
</body>
</html>
