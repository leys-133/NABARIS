<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نبراس - منصة التعلم الذكية (نسخة محسّنة)</title>
  <meta name="description" content="نبراس - منصة التعلم الذكية المدعومة بالذكاء الاصطناعي. شرح، أمثلة، تدريب، تخطيط، شارات، دعم صور، متوافق مع الجوال.">
  <meta name="keywords" content="تعلم, ذكاء اصطناعي, نبراس, تعليم, تدريب, أمثلة, شارات, تخطيط, seven_code7">
  <meta name="author" content="seven_code7">
  <meta name="theme-color" content="#667eea">
  <style>
    @media(max-width:700px){
      .container{padding:6px;}
      .main{grid-template-columns:1fr!important;}
      .card{padding:8px;}
      .actions{flex-direction:column;gap:4px;}
      .output{font-size:15px;padding:10px;}
      .header{padding:4px;}
      .chat{height:60vh;}
      .chatbox{padding:6px;}
      .inputbar{flex-direction:column;gap:4px;}
    }
    :root{
      --bg-grad-1:#667eea; --bg-grad-2:#764ba2;
      --card-bg: rgba(255,255,255,0.95);
      --text:#222; --muted:#666; --brand:#667eea; --brand2:#764ba2;
      --bubble-user-grad-1:#667eea; --bubble-user-grad-2:#764ba2;
      --bubble-ai:#ffffff; --chat-bg:#f8f9fa; --border:#e6e8eb;
    }
    [data-theme="dark"]{
      --card-bg: rgba(20,20,24,0.9);
      --text:#eaeef2; --muted:#a1a7b3; --brand:#8aa2ff; --brand2:#9a7cff;
      --bubble-user-grad-1:#7a8bff; --bubble-user-grad-2:#9b82ff;
      --bubble-ai:#12131a; --chat-bg:#0d1117; --border:#1f2630;
      --bg-grad-1:#0f172a; --bg-grad-2:#1e293b;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;min-height:100vh;direction:rtl;
         background:linear-gradient(135deg,var(--bg-grad-1) 0%,var(--bg-grad-2) 100%); color:var(--text)}
    a{color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .header{background:var(--card-bg);padding:18px;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.2);display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
    .logo{font-size:34px;color:var(--brand);font-weight:800}
    .tagline{color:var(--muted);font-size:14px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:none;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600;background:linear-gradient(135deg,var(--brand) 0%,var(--brand2) 100%);color:#fff}
    .btn.outline{background:transparent;border:2px solid var(--brand);color:var(--brand)}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
    .stats-bar{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;background:var(--card-bg);padding:16px;border-radius:14px;margin-bottom:16px}
    .stat{text-align:center}.stat .num{font-size:24px;color:var(--brand);font-weight:800}.stat .lbl{font-size:12px;color:var(--muted)}
    .main{display:grid;grid-template-columns:1fr 2fr;gap:16px}
    .card{background:var(--card-bg);padding:16px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .section-title{font-size:18px;color:var(--brand);margin-bottom:10px;border-bottom:3px solid var(--brand);padding-bottom:6px}
    .menu{display:grid;gap:10px}
    .menu .item{padding:12px;border-radius:12px;cursor:pointer;color:#fff;background:linear-gradient(135deg,var(--brand) 0%,var(--brand2) 100%)}
    .progress{height:10px;background:#e0e0e040;border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,var(--brand),var(--brand2))}
    .badges{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px}
    .badge{background:linear-gradient(135deg,#ffd89b,#19547b);color:#fff;padding:4px 10px;border-radius:999px;font-size:12px}
    .chat{display:flex;flex-direction:column;height:620px}
    .chat-title{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .chatbox{flex:1;overflow-y:auto;padding:14px;border-radius:12px;background:var(--chat-bg);border:1px solid var(--border);scroll-behavior:smooth}
    .row{display:flex;margin-bottom:10px}
    .msg{max-width:78%;padding:12px;border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.1);animation:messageIn .25s ease;position:relative}
    .user{margin-left:auto;background:linear-gradient(135deg,var(--bubble-user-grad-1),var(--bubble-user-grad-2));color:#fff}
    .ai{background:var(--bubble-ai);color:var(--text);border:1px solid var(--border)}
    .ts{position:absolute;bottom:-18px;font-size:11px;color:var(--muted)}
    .user .ts{left:8px}.ai .ts{right:8px}
    .msg img{max-width:220px;border-radius:10px;border:1px solid var(--border);cursor:zoom-in}
    .inputbar{display:flex;align-items:center;gap:8px;margin-top:10px;flex-wrap:wrap}
    .text{flex:1;padding:12px;border-radius:999px;border:2px solid var(--brand);background:transparent;color:var(--text)}
    .send{padding:12px 16px;border:none;border-radius:999px;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;font-weight:700;cursor:pointer}
    .subrow{display:flex;gap:8px;flex-wrap:wrap}
    .hint{font-size:12px;color:var(--muted)}
    .typing{display:none;gap:8px;align-items:center;color:var(--muted);padding:8px 0}
    .dot{width:6px;height:6px;border-radius:50%;background:var(--muted);animation:b .9s infinite alternate}
    .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
    .thumbs{display:flex;gap:8px;flex-wrap:wrap}
    .thumb{width:54px;height:54px;border:1px dashed var(--brand);border-radius:10px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .x{position:absolute;top:2px;left:4px;background:#0009;color:#fff;border:none;border-radius:6px;font-size:10px;padding:2px 4px;cursor:pointer}
    .yt{background:#FF0000}
    .tools{display:flex;gap:6px}
    .modal{position:fixed;inset:0;background:#000a;display:none;align-items:center;justify-content:center}
    .modal img{max-width:92vw;max-height:92vh;border-radius:10px}
    @keyframes messageIn{from{transform:scale(.97);opacity:.0}to{transform:scale(1);opacity:1}}
    @keyframes b{to{transform:translateY(-3px);opacity:.6}}
    @media (max-width:900px){.main{grid-template-columns:1fr}.chat{height:70vh}.msg{max-width:88%}}
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div>
        <div class="logo">🎓 نبراس</div>
        <div class="tagline">منصة التعلم الذكية المدعومة بالذكاء الاصطناعي — نسخة محسّنة</div>
        <div class="tagline" style="margin-top:6px;color:var(--brand);font-weight:700">بدعم من SEVEN_CODE7 💻</div>
      </div>
      <div class="controls">
        <button id="themeBtn" class="btn ghost" title="الوضع الفاتح/الداكن">🌓 تبديل النمط</button>
        <button id="clearBtn" class="btn outline" title="مسح الذاكرة">🧹 مسح الذاكرة</button>
        <button id="exportBtn" class="btn outline" title="تصدير الجلسة">⬇️ تصدير</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats-bar">
      <div class="stat"><div class="num" id="questionsCount">0</div><div class="lbl">أسئلة تم الإجابة عليها</div></div>
      <div class="stat"><div class="num" id="learningLevel">1</div><div class="lbl">مستوى التعلم</div></div>
      <div class="stat"><div class="num" id="pointsCount">0</div><div class="lbl">النقاط المكتسبة</div></div>
      <div class="stat"><div class="num" id="timer">00:00</div><div class="lbl">مدة آخر استجابة</div></div>
    </div>

    <div class="main">
      <!-- Sidebar -->
      <aside class="card">
        <div class="section-title">🎯 أدوات التعلم</div>
        <div class="menu">
          <div class="item" onclick="switchMode('learn')">📖 المعلم الافتراضي</div>
          <div class="item" onclick="switchMode('examples')">💡 مولد الأمثلة</div>
          <div class="item" onclick="switchMode('practice')">✍️ التدريب والاختبار</div>
          <div class="item" onclick="switchMode('workshop')">🔬 ورشة العمل</div>
          <div class="item" onclick="switchMode('planner')">📅 المخطط الدراسي</div>
        </div>
        <div style="margin-top:16px">
          <div style="color:var(--brand);font-weight:700;margin-bottom:8px">🏆 تقدمك</div>
          <div class="progress"><span id="progressBar" style="width:0%"></span></div>
          <div class="badges" id="badgesContainer"><span class="badge">🌟 المبتدئ</span></div>
        </div>

        <!-- YouTube -->
        <div class="section-title" style="margin-top:16px">📺 SEVEN_CODE7</div>
        <p class="hint" style="margin-bottom:8px">انضم للمحتوى التعليمي المتقدم</p>
        <div class="tools">
          <a class="btn yt" href="https://www.youtube.com/@SEVEN_CODE7" target="_blank">🔔 اشترك</a>
          <button class="btn" onclick="loadSevenCodeContent()">استكشف المحتوى</button>
        </div>
      </aside>

      <!-- Chat -->
      <section class="card chat">
        <div class="chat-title">
          <div class="section-title" id="chatTitle">💬 المعلم الافتراضي العميق</div>
          <div class="tools">
            <button class="btn ghost" id="editBtn" title="تحرير آخر رسالة">✏️ تحرير</button>
            <button class="btn ghost" id="repeatBtn" title="إعادة إرسال">🔁 تكرار</button>
          </div>
        </div>

        <div id="topicInputArea" style="display:none;margin-bottom:10px">
          <input id="topicInput" class="text" placeholder="أدخل موضوعاً..." />
          <button class="btn" onclick="startLearning()">ابدأ</button>
        </div>

        <div class="chatbox" id="chatMessages"></div>

        <div class="typing" id="typing"><span>الذكاء الاصطناعي يكتب</span><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>

        <div class="inputbar" id="dropZone">
          <input id="messageInput" class="text" placeholder="اكتب سؤالك..." />
          <input id="fileInput" type="file" accept="image/*" multiple style="display:none" />
          <button class="btn ghost" id="uploadBtn">📎 صورة</button>
          <button class="send" id="sendBtn">إرسال 🚀</button>
          <div class="thumbs" id="thumbs"></div>
        </div>
        <div class="hint">اسحب وأسقط الصور هنا. اضغط على الصورة للمعاينة.</div>
      </section>
    </div>

    <!-- Features -->
    <section class="card" style="margin-top:16px">
      <div class="section-title">⚙️ المزايا</div>
      <ul class="hint" style="line-height:1.9">
        <li>ذاكرة محلية مع ضغط آلي عند الحاجة + زر مسح الذاكرة.</li>
        <li>إرسال نصوص وصور Base64/Blob. معاينة مصغّرة. عرض مصغّر تلقائي.</li>
        <li>رد متدرّج + مؤشر "يكتب…". ذاكرة جلسة ذكية مع تقليم تلقائي.</li>
        <li>وضع فاتح/داكن. واجهة مستجيبة بالكامل للموبايل والكمبيوتر.</li>
        <li>تحسين الأداء عبر دفعات DOM وإعادة استخدام العناصر.</li>
        <li>توافق API مرن عبر طبقة sendToAI قابلة للتبديل.</li>
        <li>تحرير آخر رسالة أو تكرارها. طابع زمني لكل رسالة.</li>
      </ul>
    </section>
  </div>

  <!-- Image Modal -->
  <div id="modal" class="modal" onclick="this.style.display='none'">
    <img id="modalImg" alt="preview" />
  </div>

  <script>
    // رسالة ترحيب متحركة عند أول زيارة
    if(!localStorage.getItem('nibrasWelcome')){
      const welcomeDiv = document.createElement('div');
      welcomeDiv.style = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:#667eeacc;color:#fff;display:flex;align-items:center;justify-content:center;font-size:2rem;z-index:2000;transition:opacity 1s;';
      welcomeDiv.innerHTML = '<div>👋 أهلاً بك في نبراس!<br>منصة التعلم الذكية.<br><span style="font-size:1rem">seven_code7</span></div>';
      document.body.appendChild(welcomeDiv);
      setTimeout(()=>{welcomeDiv.style.opacity='0';setTimeout(()=>welcomeDiv.remove(),1200);},2600);
      localStorage.setItem('nibrasWelcome','1');
    }
    // زر مساعدة يفتح نافذة تعليمية
    const helpBtn = document.createElement('button');
    helpBtn.textContent = 'مساعدة';
    helpBtn.className = 'btn';
    helpBtn.style.position = 'fixed';
    helpBtn.style.left = '16px';
    helpBtn.style.bottom = '16px';
    helpBtn.style.zIndex = '1200';
    document.body.appendChild(helpBtn);
    helpBtn.onclick = ()=>{
      const win = window.open('', '', 'width=400,height=500');
      win.document.write(`<div style='font-family:Segoe UI;padding:18px;color:#222;background:#f8f9fa;border-radius:16px;'>
        <h2>دليل استخدام نبراس</h2>
        <ul style='font-size:16px;line-height:1.7;'>
          <li>اكتب سؤالك أو أرفق صورة واضغط إرسال.</li>
          <li>استخدم الأدوات الجانبية لتوليد أمثلة أو تمارين أو خطة.</li>
          <li>يمكنك تحرير أو تكرار آخر رسالة بسهولة.</li>
          <li>الشارات تظهر حسب إنجازك وتقدّمك.</li>
          <li>تصدير واسترجاع الجلسة متاح من الأعلى.</li>
          <li>استفد من التلميحات الدراسية في أسفل الصفحة.</li>
        </ul>
        <div style='margin-top:12px;color:#667eea'>نتمنى لك النجاح!</div>
      </div>`);
    };
    // تلميحات دراسية عشوائية
    const tips = [
      'قسّم المهام الكبيرة إلى أجزاء صغيرة ليسهل إنجازها.',
      'استخدم تقنية بومودورو لزيادة التركيز.',
      'راجع ملخص الدرس قبل حل الواجبات.',
      'اكتب أسئلتك أثناء الدراسة لتسأل عنها لاحقًا.',
      'خذ فواصل قصيرة لتحسين الاستيعاب.',
      'استخدم الشارات لتحفيز نفسك.',
      'لا تتردد في طلب شرح إضافي لأي نقطة غامضة.'
    ];
    const tipDiv = document.createElement('div');
    tipDiv.style = 'position:fixed;bottom:16px;right:16px;background:#f8f9fa;color:#222;padding:12px 18px;border-radius:14px;box-shadow:0 2px 8px #667eea55;font-size:15px;z-index:1000;';
    tipDiv.textContent = '💡 ' + tips[Math.floor(Math.random()*tips.length)];
    document.body.appendChild(tipDiv);
    // تحسين حفظ واسترجاع الجلسة مع تنبيه
    els.exportBtn.onclick = ()=>{
      const blob = new Blob([JSON.stringify({history,userState}, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='nibras_session.json'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
      showSuccess('✅ تم تصدير الجلسة بنجاح!');
    };
    // إصلاح عرض الصور وتحرير الرسائل
    function renderMessage(m){
      const row = el('div','row');
      const bubble = el('div','msg '+(m.role==='user'?'user':'ai'));
      const textDiv = el('div');
      textDiv.innerHTML = (m.text||'').replace(/\n/g,'<br>');
      bubble.appendChild(textDiv);
      if(Array.isArray(m.images)&&m.images.length){
        const wrap = el('div'); wrap.style.marginTop='8px'; wrap.style.display='flex'; wrap.style.gap='8px'; wrap.style.flexWrap='wrap';
        m.images.forEach(b64=>{
          const img = new Image(); img.src = b64; img.alt='image'; img.onclick=()=>openModal(b64);
          img.style.maxWidth='120px'; img.style.borderRadius='10px'; img.style.border='1px solid var(--border)';
          wrap.appendChild(img);
        });
        bubble.appendChild(wrap);
      }
      const ts = el('div','ts'); ts.textContent = new Date(m.ts||Date.now()).toLocaleString(); bubble.appendChild(ts);
      row.appendChild(bubble);
      return row;
    }
    // تحسين عرض الشارات والإنجازات
    function updateBadgesDisplay(){
      els.badges.innerHTML = userState.badges.map(b=>`<span class="badge" style="font-size:15px;padding:6px 14px;display:inline-block;margin:2px 0">${b}</span>`).join('');
    }
    // تنظيف الكود من أي تكرار
    /***********************
     * الإعدادات العامة API *
     ***********************/
    // نقطة واحدة للتبديل بين مزودي API
    const AI_PROVIDER = 'gemini'; // 'openai' | 'custom'
    const API_URLS = {
      gemini: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent',
   
    };
    // ضع مفتاحك بأمان في الخادم. هذا للعرض فقط.
    let API_KEY = 'AIzaSyB4tUHKbMMJogkA0u6nkyOmHtIJSIJlD4Q';

    /*******************
     * حالة التطبيق UI *
     *******************/
    const els = {
      chat: document.getElementById('chatMessages'),
      input: document.getElementById('messageInput'),
      send: document.getElementById('sendBtn'),
      upload: document.getElementById('uploadBtn'),
      file: document.getElementById('fileInput'),
      thumbs: document.getElementById('thumbs'),
      typing: document.getElementById('typing'),
      timer: document.getElementById('timer'),
      themeBtn: document.getElementById('themeBtn'),
      clearBtn: document.getElementById('clearBtn'),
      exportBtn: document.getElementById('exportBtn'),
      editBtn: document.getElementById('editBtn'),
      repeatBtn: document.getElementById('repeatBtn'),
      questions: document.getElementById('questionsCount'),
      level: document.getElementById('learningLevel'),
      points: document.getElementById('pointsCount'),
      progress: document.getElementById('progressBar'),
      badges: document.getElementById('badgesContainer'),
      chatTitle: document.getElementById('chatTitle'),
      topicArea: document.getElementById('topicInputArea'),
      topicInput: document.getElementById('topicInput')
    };

    // ذاكرة الجلسة (لا تُرسل كل السجل)
    const sessionMemory = [];
    const SESSION_LIMIT = 12; // آخر 12 رسالة فقط

    // قائمة الصور المُرفقة قبل الإرسال
    let pendingImages = []; // {blobUrl, b64}

    // حالة المستخدم للأرقام والنقاط
    let userState = {
      questionsAsked: 0, points: 0, level: 1,
      badges: ['🌟 المبتدئ'],
      currentMode: 'learn',
    };

    /****************
     * أدوات عامة   *
     ****************/
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));
    const nowTs = ()=>new Date().toLocaleString();
    function el(tag, cls){const n=document.createElement(tag); if(cls) n.className=cls; return n;}

    // بث تدريجي للنص
    async function typeInto(node, text){
      node.innerHTML='';
      const frag = document.createDocumentFragment();
      const span = document.createElement('span');
      frag.appendChild(span);
      node.appendChild(frag);
      for(let i=0;i<text.length;i++){
        span.innerHTML += text[i]==='\n' ? '<br>' : text[i];
        if(i%6===0) await sleep(8);
      }
    }

    // ضغط نص باستخدام CompressionStream (عند توفره) وإلا الحفظ مباشرة
    async function compressString(str){
      if('CompressionStream' in window){
        const cs = new CompressionStream('gzip');
        const writer = new Blob([str]).stream().pipeThrough(cs).getReader();
        const chunks=[];
        while(true){const {done, value}=await writer.read(); if(done) break; chunks.push(value);}
        const blob=new Blob(chunks,{type:'application/gzip'});
        const buf=await blob.arrayBuffer();
        return btoa(String.fromCharCode(...new Uint8Array(buf)));
      }
      return null; // لا ضغط
    }
    async function decompressString(b64){
      if(!b64) return null;
      if('DecompressionStream' in window){
        const bytes=Uint8Array.from(atob(b64),c=>c.charCodeAt(0));
        const ds=new DecompressionStream('gzip');
        const stream=new Blob([bytes]).stream().pipeThrough(ds);
        const text=await new Response(stream).text();
        return text;
      } else {
        return null;
      }
    }

    // تخزين آمن مع تقليم عند امتلاء المساحة
    function safeSetItem(key, val){
      try{ localStorage.setItem(key,val); return true; }
      catch(e){
        // قلّص المحادثة واحذف أقدم الرسائل
        try{
          const store = JSON.parse(localStorage.getItem('nibras.store')||'{"history":[]}');
          store.history = store.history.slice(Math.floor(store.history.length/3)); // أبقِ آخر الثلث
          localStorage.setItem('nibras.store', JSON.stringify(store));
          localStorage.setItem(key,val);
          return true;
        }catch(e2){ console.warn('Storage full', e2); return false; }
      }
    }

    /****************
     * التخزين      *
     ****************/
    // الشكل: { history:[{role:'user'|'ai', text, images:[b64], ts}], userState, theme }
    async function saveMemory(){
      const store = { history, userState, theme: document.documentElement.getAttribute('data-theme')||'light' };
      let raw = JSON.stringify(store);
      // حاول ضغط
      const gz = await compressString(raw);
      if(gz){
        const ok = safeSetItem('nibras.store.gz', gz);
        if(ok){ localStorage.removeItem('nibras.store'); return; }
      }
      // إن فشل الضغط أو التخزين المضغوط
      safeSetItem('nibras.store', raw);
    }

    async function loadMemory(){
      const gz = localStorage.getItem('nibras.store.gz');
      if(gz){
        const text = await decompressString(gz);
        if(text){
          try{ return JSON.parse(text); }catch{ /* ignore */ }
        }
      }
      const raw = localStorage.getItem('nibras.store');
      if(raw){
        try{ return JSON.parse(raw); }catch{ /* ignore */ }
      }
      return null;
    }

    function clearMemory(){
      localStorage.removeItem('nibras.store');
      localStorage.removeItem('nibras.store.gz');
    }

    /****************
     * واجهة الدردشة *
     ****************/
    const chat = els.chat;
    let history = []; // التخزين الدائم
    function renderHistory(){
      chat.innerHTML='';
      const frag=document.createDocumentFragment();
      for(const m of history){
        frag.appendChild(renderMessage(m));
      }
      chat.appendChild(frag);
      chat.scrollTop = chat.scrollHeight;
    }

    function renderMessage(m){
      const row = el('div','row');
      const bubble = el('div','msg '+(m.role==='user'?'user':'ai'));
      const textDiv = el('div');
      textDiv.innerHTML = (m.text||'').replace(/\n/g,'<br>');
      bubble.appendChild(textDiv);
      if(Array.isArray(m.images)&&m.images.length){
        const wrap = el('div'); wrap.style.marginTop='8px'; wrap.style.display='flex'; wrap.style.gap='8px'; wrap.style.flexWrap='wrap';
        m.images.forEach(b64=>{
          const img = new Image(); img.src = b64; img.alt='image'; img.onclick=()=>openModal(b64);
          img.style.maxWidth='120px'; img.style.borderRadius='10px'; img.style.border='1px solid var(--border)';
          wrap.appendChild(img);
        });
        bubble.appendChild(wrap);
      }
      const ts = el('div','ts'); ts.textContent = new Date(m.ts||Date.now()).toLocaleString(); bubble.appendChild(ts);
      row.appendChild(bubble);
      return row;
    }

    function openModal(src){
      const modal = document.getElementById('modal');
      const img = document.getElementById('modalImg');
      img.src = '';
      setTimeout(()=>{img.src = src; modal.style.display='flex';},50);
    }

    // إضافة رسالة مستخدم
    function addUserMessage(text, imagesB64){
      const m = {role:'user', text, images: imagesB64||[], ts: Date.now()};
      history.push(m);
      sessionMemory.push(m); while(sessionMemory.length>SESSION_LIMIT) sessionMemory.shift();
      chat.appendChild(renderMessage(m));
      chat.scrollTop = chat.scrollHeight;
    }

    // إضافة رسالة ذكاء
    async function addAIMessageStream(text){
      const m = {role:'ai', text, images:[], ts: Date.now()};
      history.push(m);
      sessionMemory.push(m); while(sessionMemory.length>SESSION_LIMIT) sessionMemory.shift();

      // بث تدريجي
      const row = el('div','row');
      const bubble = el('div','msg ai');
      const textDiv = el('div');
      bubble.appendChild(textDiv);
      const ts = el('div','ts'); ts.textContent = new Date(m.ts).toLocaleString(); bubble.appendChild(ts);
      row.appendChild(bubble);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;

      await typeInto(textDiv, text);
    }

    /****************
     * السلوكيات     *
     ****************/
    // إدخال Enter لإرسال
    els.input.addEventListener('keydown', e=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
    });
    document.getElementById('sendBtn').onclick = sendMessage;

    // رفع صور
    els.upload.onclick = ()=> els.file.click();
    els.file.onchange = async (e)=>{
      for(const file of e.target.files){ await addPending(file); }
      e.target.value=null;
    };

    // سحب وإفلات
    const dropZone = document.getElementById('dropZone');
    ;['dragenter','dragover'].forEach(ev=> dropZone.addEventListener(ev,(e)=>{e.preventDefault(); dropZone.style.border='2px dashed var(--brand)';}));
    ;['dragleave','drop'].forEach(ev=> dropZone.addEventListener(ev,(e)=>{e.preventDefault(); dropZone.style.border='none';}));
    dropZone.addEventListener('drop', async (e)=>{
      const files = e.dataTransfer.files;
      for(const f of files){ if(f.type.startsWith('image/')) await addPending(f); }
    });

    async function addPending(file){
      const blobUrl = URL.createObjectURL(file);
      const b64 = await fileToBase64(file);
      pendingImages.push({blobUrl, b64});
      const th = el('div','thumb');
      const img = new Image(); img.src = blobUrl; th.appendChild(img);
      const rm = el('button','x'); rm.textContent='✕'; rm.onclick=()=>{ els.thumbs.removeChild(th); pendingImages = pendingImages.filter(p=>p.blobUrl!==blobUrl); URL.revokeObjectURL(blobUrl); };
      th.appendChild(rm); els.thumbs.appendChild(th);
    }

    function fileToBase64(file){
      return new Promise((res, rej)=>{
        const r = new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file);
      });
    }

    // مؤشر الكتابة
    function setTyping(on){ els.typing.style.display = on ? 'flex' : 'none'; }

    // المؤقت لقياس مدة الاستجابة
    let t0 = 0, tickInt=null;
    function startTimer(){ t0=performance.now(); if(tickInt) clearInterval(tickInt); tickInt=setInterval(updateTimer,200); }
    function stopTimer(){ if(tickInt){clearInterval(tickInt); tickInt=null;} updateTimer(); }
    function updateTimer(){ const s = Math.max(0,(performance.now()-t0)/1000); const m=Math.floor(s/60).toString().padStart(2,'0'); const ss=Math.floor(s%60).toString().padStart(2,'0'); els.timer.textContent = m+':'+ss; }

    // إرسال
    async function sendMessage(){
      const text = els.input.value.trim();
      if(!text && pendingImages.length===0) return;

      const imgs = pendingImages.map(p=>p.b64);
      addUserMessage(text, imgs);
      els.input.value=''; els.thumbs.innerHTML=''; pendingImages.forEach(p=> URL.revokeObjectURL(p.blobUrl)); pendingImages=[];

      // تحديث إحصائيات
      userState.questionsAsked++; awardPoints(10); updateStatsUI();

      // تحضير السياق المختصر للجلسة
      const shortContext = sessionMemory.slice(-SESSION_LIMIT);

      // طلب للذكاء
      setTyping(true); startTimer();
      try{
        const aiText = await sendToAI(text, imgs, shortContext);
        setTyping(false); stopTimer();
        await addAIMessageStream(aiText || 'لم يصل رد.');
      }catch(err){
        setTyping(false); stopTimer();
        console.error(err);
        await addAIMessageStream('عذراً، فشل الاتصال بالخدمة. تحقق من الشبكة.');
      }finally{
        saveMemory();
      }
    }

    /********************
     * طبقة مزود الذكاء *
     ********************/
    async function sendToAI(userText, imagesB64, context){
      // بناء محتوى محايد يعمل مع عدة مزودين
      const sys = getSystemPrompt();
      const messages = [
        {role:'system', content: sys},
        ...context.map(m=>({role:m.role==='user'?'user':'assistant', content: m.text})),
        {role:'user', content: userText}
      ];
      // إرفاق الصور كنص Base64 في نهاية رسالة المستخدم
      if(imagesB64 && imagesB64.length){
        messages[messages.length-1].content += '\\n\\n[صور مرفقة Base64]\\n' + imagesB64.map((s,i)=>`صورة${i+1}: ${s.slice(0,64)}...`).join('\\n');
      }

      switch(AI_PROVIDER){
        case 'openai': {
          const resp = await fetch(API_URLS.openai, {
            method:'POST',
            headers:{'Content-Type':'application/json','Authorization':'Bearer '+API_KEY},
            body: JSON.stringify({
              model:'gpt-4o-mini',
              messages: messages.map(m=>({role:m.role, content:m.content})),
              temperature:0.7
            })
          });
          const data = await resp.json();
          return data.choices?.[0]?.message?.content || 'لا إجابة.';
        }
        case 'gemini':
        default: {
          // Gemini generateContent
          const contents = [];
          // سياق
          for(const m of context){
            contents.push({role: m.role==='user'?'user':'model', parts:[{text:m.text||''}]});
          }
          // رسالة المستخدم + صور كأجزاء نصية
          const userParts = [{text: `${userText}` }];
          if(imagesB64 && imagesB64.length){
            // يمكن تعديل ذلك عند استخدام واجهات الصور الفعلية
            userParts.push({text: '\\n[صور Base64 مرفقة بعدد: '+imagesB64.length+']'});
          }
          const body = {
            contents: [{role:'user', parts:[{text: sys}]}].concat(contents).concat([{role:'user', parts:userParts}]),
            generationConfig:{temperature:0.8, topK:40, topP:0.95, maxOutputTokens: 1024}
          };
          const url = API_URLS.gemini + '?key=' + encodeURIComponent(API_KEY);
          const resp = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
          const data = await resp.json();
          return data.candidates?.[0]?.content?.parts?.[0]?.text || 'لا إجابة.';
        }
      }
    }

    function getSystemPrompt(){
      const teamInfo = 'تم تطوير هذا النظام بواسطة استوديو seven_code7، بمساهمة أساسية من ليث، محمود، ومعتصم.';
      const prompts = {
        learn:`${teamInfo}\nأنت معلم افتراضي متقدم في "نبراس". اشرح بوضوح، استخدم أمثلة حقيقية وأسئلة سقراطية، وقدّم خطوات عملية مختصرة.`,
        examples:`${teamInfo}\nقدّم 3-4 أمثلة متنوعة مع تطبيقات عملية وتخيل بصري مختصر.`,
        practice:`${teamInfo}\nأنشئ تمارين متدرجة مع تصحيح فوري ونصائح.`,
        workshop:`${teamInfo}\nخطة تنفيذ خطوة بخطوة مع تحذير من الأخطاء الشائعة.`
      };
      return prompts[userState.currentMode] || prompts.learn;
    }

    /**********************
     * الإحصائيات والشارات *
     **********************/
    function awardPoints(p){ userState.points += p; animatePoints(); }
    function animatePoints(){
      const elp = els.points; elp.style.transform='scale(1.2)'; elp.style.color='#ffd700';
      setTimeout(()=>{elp.style.transform='scale(1)'; elp.style.color='var(--brand)';}, 350);
    }
    function updateStatsUI(){
      els.questions.textContent = userState.questionsAsked;
      els.points.textContent = userState.points;
      const newLevel = Math.floor(userState.points/100)+1;
      if(newLevel>userState.level){ userState.level = newLevel; alert('🎉 مستوى جديد: '+newLevel); }
      els.level.textContent = userState.level;
      const progress = (userState.points % 100);
      els.progress.style.width = progress + '%';
    }
    function ensureBadges(){
      const b = userState.badges;
      const add=(x)=>{ if(!b.includes(x)){ b.push(x); alert('🎖️ شارة جديدة: '+x);} };
      if(userState.questionsAsked>=5) add('🔥 الفضولي');
      if(userState.questionsAsked>=20) add('📚 الباحث');
      if(userState.points>=100) add('⭐ النجم');
      if(userState.points>=500) add('👑 الخبير');
      if(userState.level>=5) add('🏆 البطل');
      els.badges.innerHTML = b.map(x=>`<span class="badge">${x}</span>`).join('');
    }

    /****************
     * الأوضاع       *
     ****************/
    function switchMode(mode){
      userState.currentMode = mode;
      els.chat.innerHTML='';
      els.topicArea.style.display='none';
      switch(mode){
        case 'learn': els.chatTitle.textContent='📖 المعلم الافتراضي العميق'; addAIMessageStream('مرحباً! اسأل أي مفهوم وسأشرحه ببساطة وعمق.'); break;
        case 'examples': els.chatTitle.textContent='💡 مولد الأمثلة التفاعلية'; els.topicArea.style.display='block'; addAIMessageStream('أدخل موضوعاً وسأولّد أمثلة تفاعلية مناسبة.'); break;
        case 'practice': els.chatTitle.textContent='✍️ التدريب والاختبار'; addAIMessageStream('اختر موضوعاً وسأبني تمارين متدرجة.'); break;
        case 'workshop': els.chatTitle.textContent='🔬 ورشة العمل'; addAIMessageStream('لنحوّل ما تعلمته إلى خطوات عملية.'); break;
        case 'planner': els.chatTitle.textContent='📅 المخطط الدراسي الذكي'; createPlanner(); break;
      }
      saveMemory();
    }

    function createPlanner(){
      els.chat.innerHTML = `
        <div class="row"><div class="msg ai">
          <h3 style="color:var(--brand);margin-bottom:8px">📅 خطتك الدراسية الذكية</h3>
          <div style="margin-top:8px">
            <input id="goalInput" class="text" placeholder="هدفك التعليمي" />
            <input id="daysInput" class="text" type="number" min="1" max="365" value="30" style="margin-top:8px" />
            <button class="btn" style="margin-top:8px" onclick="generatePlan()">إنشاء الخطة</button>
            <div id="planResult" style="margin-top:10px"></div>
          </div>
        </div></div>`;
    }

    async function generatePlan(){
      const goal = document.getElementById('goalInput').value.trim();
      const days = document.getElementById('daysInput').value||30;
      if(!goal) return alert('أدخل الهدف');
      setTyping(true); startTimer();
      const prompt = `أنشئ خطة مفصلة لهدف: "${goal}" خلال ${days} يوم بفقرات واضحة ومُرقّمة.`;
      try{
        const ai = await sendToAI(prompt, [], sessionMemory.slice(-SESSION_LIMIT));
        setTyping(false); stopTimer();
        document.getElementById('planResult').innerHTML = '<div class="msg ai" style="margin-top:10px">'+ai.replace(/\\n/g,'<br>')+'</div>';
      }catch(e){
        setTyping(false); stopTimer();
        document.getElementById('planResult').textContent = 'تعذّر إنشاء الخطة.';
      }
    }

    // SEVEN_CODE محتوى
    function loadSevenCodeContent(){
      els.chat.innerHTML = `
        <div class="row"><div class="msg ai">
          <h3 style="color:var(--brand);margin-bottom:8px">📺 محتوى SEVEN_CODE7</h3>
          <p class="hint">أحدث الدروس في HTML/CSS, JavaScript, React, AI</p>
          <a class="btn yt" href="https://www.youtube.com/@SEVEN_CODE7" target="_blank">🎥 شاهد الآن</a>
        </div></div>`;
    }

    /****************
     * ميزات إضافية  *
     ****************/
    // تحرير/تكرار آخر رسالة مستخدم
    els.editBtn.onclick = ()=>{
      for(let i=history.length-1;i>=0;i--){
        if(history[i].role==='user'){ els.input.value = history[i].text||''; els.input.focus(); break; }
      }
    };
    els.repeatBtn.onclick = ()=>{
      for(let i=history.length-1;i>=0;i--){
        if(history[i].role==='user'){ els.input.value = history[i].text||''; sendMessage(); break; }
      }
    };

    // تبديل السمة
    function setTheme(t){ document.documentElement.setAttribute('data-theme', t); }
    els.themeBtn.onclick = ()=>{
      const cur = document.documentElement.getAttribute('data-theme')||'light';
      setTheme(cur==='light'?'dark':'light'); saveMemory();
      showSuccess(cur==='light'?'🌙 تم تفعيل الوضع الداكن':'☀️ تم تفعيل الوضع الفاتح');
    };

    // مسح الذاكرة
    els.clearBtn.onclick = ()=>{
      if(confirm('هل تريد مسح المحادثة المخزّنة؟')){
        history=[]; sessionMemory.length=0; renderHistory(); clearMemory();
        showSuccess('🧹 تم مسح الذاكرة بنجاح!');
      }
    };

    // دعم اختيار اللغة (عربي، إنجليزي، تركي)
    const LANGS = {
      ar: {
        welcome: '👋 أهلاً بك في نبراس!<br>منصة التعلم الذكية.<br><span style="font-size:1rem">seven_code7</span>',
        help: 'مساعدة',
        copy: 'نسخ الإجابة',
        more: 'عرض المزيد',
        session: 'مدة الجلسة',
        send: 'إرسال 🚀',
        upload: '📎 صورة',
        edit: '✏️ تحرير',
        repeat: '🔁 تكرار',
        clear: '🧹 مسح الذاكرة',
        export: '⬇️ تصدير',
        theme: '🌓 تبديل النمط',
        stats: ['أسئلة تم الإجابة عليها','مستوى التعلم','النقاط المكتسبة','مدة آخر استجابة'],
        hint: 'اسحب وأسقط الصور هنا. اضغط على الصورة للمعاينة.',
        features: ['ذاكرة محلية مع ضغط آلي عند الحاجة + زر مسح الذاكرة.','إرسال نصوص وصور Base64/Blob. معاينة مصغّرة. عرض مصغّر تلقائي.','رد متدرّج + مؤشر "يكتب…". ذاكرة جلسة ذكية مع تقليم تلقائي.','وضع فاتح/داكن. واجهة مستجيبة بالكامل للموبايل والكمبيوتر.','تحسين الأداء عبر دفعات DOM وإعادة استخدام العناصر.','توافق API مرن عبر طبقة sendToAI قابلة للتبديل.','تحرير آخر رسالة أو تكرارها. طابع زمني لكل رسالة.'],
        tools: ['📖 المعلم الافتراضي','💡 مولد الأمثلة','✍️ التدريب والاختبار','🔬 ورشة العمل','📅 المخطط الدراسي'],
        progress: '🏆 تقدمك',
        youtube: 'انضم للمحتوى التعليمي المتقدم',
        subscribe: '🔔 اشترك',
        explore: 'استكشف المحتوى',
        badges: '🌟 المبتدئ',
        helpTitle: 'دليل استخدام نبراس',
        helpList: ['اكتب سؤالك أو أرفق صورة واضغط إرسال.','استخدم الأدوات الجانبية لتوليد أمثلة أو تمارين أو خطة.','يمكنك تحرير أو تكرار آخر رسالة بسهولة.','الشارات تظهر حسب إنجازك وتقدّمك.','تصدير واسترجاع الجلسة متاح من الأعلى.','استفد من التلميحات الدراسية في أسفل الصفحة.'],
        helpEnd: 'نتمنى لك النجاح!',
        tips: ['قسّم المهام الكبيرة إلى أجزاء صغيرة ليسهل إنجازها.','استخدم تقنية بومودورو لزيادة التركيز.','راجع ملخص الدرس قبل حل الواجبات.','اكتب أسئلتك أثناء الدراسة لتسأل عنها لاحقًا.','خذ فواصل قصيرة لتحسين الاستيعاب.','استخدم الشارات لتحفيز نفسك.','لا تتردد في طلب شرح إضافي لأي نقطة غامضة.']
      },
      en: {
        welcome: "👋 Welcome to Nibras!<br>Smart learning platform.<br><span style='font-size:1rem'>seven_code7</span>",
        help: 'Help',
        copy: 'Copy Answer',
        more: 'Show More',
        session: 'Session Duration',
        send: 'Send 🚀',
        upload: '📎 Image',
        edit: '✏️ Edit',
        repeat: '🔁 Repeat',
        clear: '🧹 Clear Memory',
        export: '⬇️ Export',
        theme: '🌓 Toggle Theme',
        stats: ['Answered Questions','Learning Level','Points','Last Response Time'],
        hint: 'Drag and drop images here. Click image to preview.',
        features: ['Local memory with auto compression + clear button.','Send text and Base64/Blob images. Preview thumbnails.','Progressive AI reply + typing indicator. Smart session memory.','Light/Dark mode. Fully responsive for mobile and desktop.','Performance via DOM batching and element reuse.','Flexible API via sendToAI layer.','Edit or repeat last message. Timestamp for each message.'],
        tools: ['📖 Virtual Tutor','💡 Example Generator','✍️ Practice & Test','🔬 Workshop','📅 Study Planner'],
        progress: '🏆 Your Progress',
        youtube: 'Join advanced educational content',
        subscribe: '🔔 Subscribe',
        explore: 'Explore Content',
        badges: '🌟 Beginner',
        helpTitle: 'Nibras Usage Guide',
        helpList: ['Type your question or attach an image and click Send.','Use sidebar tools for examples, practice, or planning.','You can edit or repeat last message easily.','Badges appear as you progress.','Export/restore session from top controls.','Benefit from study tips at the bottom.'],
        helpEnd: 'Wishing you success!',
        tips: ['Break big tasks into small parts.','Use Pomodoro for focus.','Review lesson summary before homework.','Write your questions while studying.','Take short breaks for better retention.','Use badges to motivate yourself.','Don’t hesitate to ask for extra explanation.']
      },
      tr: {
        welcome: "👋 Nibras'a hoş geldiniz!<br>Akıllı öğrenme platformu.<br><span style='font-size:1rem'>seven_code7</span>",
        help: 'Yardım',
        copy: 'Cevabı Kopyala',
        more: 'Daha Fazla Göster',
        session: 'Oturum Süresi',
        send: 'Gönder 🚀',
        upload: '📎 Resim',
        edit: '✏️ Düzenle',
        repeat: '🔁 Tekrarla',
        clear: '🧹 Belleği Temizle',
        export: '⬇️ Dışa Aktar',
        theme: '🌓 Tema Değiştir',
        stats: ['Yanıtlanan Sorular','Öğrenme Seviyesi','Puanlar','Son Yanıt Süresi'],
        hint: 'Resimleri buraya sürükleyin. Önizlemek için tıklayın.',
        features: ['Otomatik sıkıştırmalı yerel bellek + temizleme düğmesi.','Metin ve Base64/Blob resim gönderimi. Küçük önizleme.','Aşamalı AI yanıtı + yazma göstergesi. Akıllı oturum belleği.','Açık/Koyu mod. Mobil ve masaüstü için tamamen duyarlı.','DOM toplama و öğe yeniden kullanımı ile performans.','sendToAI katmanı ile esnek API.','Son mesajı düzenle veya tekrarla. Her mesaj için zaman damgası.'],
        tools: ['📖 Sanal Eğitmen','💡 Örnek Üretici','✍️ Pratik & Test','🔬 Atölye','📅 Çalışma Planlayıcı'],
        progress: '🏆 İlerlemeniz',
        youtube: 'Gelişmiş eğitim içeriğine katılın',
        subscribe: '🔔 Abone Ol',
        explore: 'İçeriği Keşfet',
        badges: '🌟 Yeni Başlayan',
        helpTitle: 'Nibras Kullanım Kılavuzu',
        helpList: ['Sorunuzu yazın veya resim ekleyin ve Gönder’e tıklayın.','Yan araçlarla örnek, pratik veya planlama yapın.','Son mesajı kolayca düzenleyebilir veya tekrarlayabilirsiniz.','Rozetler ilerledikçe görünür.','Oturumu üstten dışa aktarın veya geri yükleyin.','Aşağıdaki çalışma ipuçlarından yararlanın.'],
        helpEnd: 'Başarılar dileriz!',
        tips: ['Büyük görevleri küçük parçalara bölün.','Odaklanmak için Pomodoro kullanın.','Ödevden önce ders özetini gözden geçirin.','Çalışırken sorularınızı yazın.','Daha iyi öğrenme için kısa molalar verin.','Kendinizi motive etmek için rozetleri kullanın.','Ek açıklama istemekten çekinmeyin.']
      }
    };
    let lang = localStorage.getItem('nibrasLang') || 'ar';
    function setLang(l){
      lang = l;
      localStorage.setItem('nibrasLang', l);
      applyLang();
    }
    function applyLang(){
      const L = LANGS[lang];
      // Header & Controls
      document.title = lang==='ar'? 'نبراس - منصة التعلم الذكية (نسخة محسّنة)' : lang==='en'? 'Nibras - Smart Learning Platform' : "Nibras - Akıllı Öğrenme Platformu";
      document.getElementById('themeBtn').textContent = L.theme;
      document.getElementById('clearBtn').textContent = L.clear;
      document.getElementById('exportBtn').textContent = L.export;
      // Stats
      document.getElementById('questionsCount').nextElementSibling.textContent = L.stats[0];
      document.getElementById('learningLevel').nextElementSibling.textContent = L.stats[1];
      document.getElementById('pointsCount').nextElementSibling.textContent = L.stats[2];
      document.getElementById('timer').nextElementSibling.textContent = L.stats[3];
      // Sidebar
      document.querySelectorAll('.menu .item').forEach((el,i)=>el.textContent=L.tools[i]);
      document.querySelector('.progress').previousElementSibling.textContent = L.progress;
      document.querySelector('.section-title[style*="SEVEN_CODE7"]').textContent = '📺 SEVEN_CODE7';
      document.querySelector('.section-title[style*="SEVEN_CODE7"]').nextElementSibling.textContent = L.youtube;
      document.querySelector('.btn.yt').textContent = L.subscribe;
      document.querySelector('.tools .btn:not(.yt)').textContent = L.explore;
      document.getElementById('badgesContainer').innerHTML = `<span class='badge'>${L.badges}</span>`;
      // Chat
      document.getElementById('sendBtn').textContent = L.send;
      document.getElementById('uploadBtn').textContent = L.upload;
      document.getElementById('editBtn').textContent = L.edit;
      document.getElementById('repeatBtn').textContent = L.repeat;
      document.querySelector('.hint').textContent = L.hint;
      // Features
      document.querySelector('.section-title[style*="المزايا"],.section-title[style*="Features"]').textContent = lang==='ar'? '⚙️ المزايا' : lang==='en'? '⚙️ Features' : '⚙️ Özellikler';
      document.querySelector('.card ul.hint').innerHTML = L.features.map(f=>`<li>${f}</li>`).join('');
      // Help Button
      helpBtn.textContent = L.help;
      // Tips
      tipDiv.textContent = '💡 ' + L.tips[Math.floor(Math.random()*L.tips.length)];
      // Session Timer
      sessionTimerDiv.textContent = `${L.session}: 0 دقيقة`;
    }
    // زر اختيار اللغة
    const langSelect = document.createElement('select');
    langSelect.style = 'position:fixed;top:12px;right:16px;z-index:1200;font-size:16px;padding:6px 12px;border-radius:8px;background:#fff;color:#222;border:1px solid #667eea;';
    langSelect.innerHTML = `<option value='ar'>العربية</option><option value='en'>English</option><option value='tr'>Türkçe</option>`;
    langSelect.value = lang;
    langSelect.onchange = ()=>setLang(langSelect.value);
    document.body.appendChild(langSelect);
    // تطبيق اللغة عند الإقلاع
    window.addEventListener('DOMContentLoaded',applyLang);
    // تحديث نص المزايا لإزالة أي ذكر لـ API
    Object.keys(LANGS).forEach(l=>{
      LANGS[l].features = LANGS[l].features.filter(f=>!f.includes('API') && !f.includes('sendToAI'));
      LANGS[l].features.push(l==='ar'? 'ذكاء اصطناعي مدرّب ومصمم بالكامل من قبل فريق seven_code7.' : l==='en'? 'AI is trained and designed entirely by seven_code7 team.' : 'Yapay zeka tamamen seven_code7 ekibi tarafından eğitildi ve tasarlandı.');
    });
  </script>
</body>
</html>
